# $Id: postfix.spec.in,v 2.304.4.37 2006/06/15 21:52:12 sjmudd Exp $
#
# File used to generate the distribution-specific postfix.spec file.
# If you need to make changes to postfix.spec, make them to postfix.spec.in
# and regenerate the spec file.
#
# See make-postfix.spec in %{_sourcedir} for more information.
#
# This spec file was built on distribution: __DISTRIBUTION__
#
# Information imported from postfix.spec.in: DO NOT CHANGE IT BY HAND
#
# mysql_paths              - paths where locally installed MySQL resides (or 0)
#                            - if using this option mysql_paths should be as
#                              follows: </pathto/mysql/include>:</pathto/mysql/lib>
#                              e.g.:    /usr/mysql/include:/usr/mysql/lib
#                            - The order is important and only 2 directories may
#                              be given.
# requires_db              - used to add dbX dependencies in the package
# smtpd_multiline_greeting - my patch to allow multiline banner
# mps			   - man page suffix, .gz except Mandrake >= 8 which uses .bz2
# with_cdb                 - include CDB support by Michael Tokarev
#                            <mjt@corpit.ru>
# with_ipv6                - include IPV6 support
# with_ldap                - include LDAP support
# with_mysql               - include support for www.mysql.com's MySQL rpms
# with_mysql_redhat        - include support for RedHat's MySQL rpms
# with_pcre                - include pcre support
# with_pgsql               - include Postgres database support
# with_sasl                - include SASL/AUTH support (0 to disable sasl,
#                            1 for sasl v1, or 2 for sasl v2, sasl_library is
#                            the sasl library to link against, distribution dependent)
# with_spf                 - include libspf2 library support
#                            - rpms for libspf can be found at http://www.sosdg.org/rpm/libspf/
#                            - apparently they work on RHEL3
# with_tls                 - include TLS support
# with_tlsfix              - include TLS fix
#                            - needed for rh6.2, rh9 and rhel3
# with_vda                 - add virtual delivery agent patch
#
# Please send bugfixes and comments to the packager.
#
# distribution which the spec file was built from
%define distribution __DISTRIBUTION__

# distribution which we are building Postfix on
# - call my script once to speed up build process
%define distro_info     %(sh $(rpm --eval '%{_sourcedir}')/postfix-get-distribution --distro-info)
%define build_dist_full %(echo "%distro_info" | cut -d" " -f5)
%define build_name      %(echo "%distro_info" | cut -d" " -f1)
%define build_major     %(echo "%distro_info" | cut -d" " -f3)
%define build_minor     %(echo "%distro_info" | cut -d" " -f4)
%define build_dist      %{build_name}-%{build_major}.%{build_minor}
%define mps %(test "%{build_name}" = mandrake -a "%{build_major}" -ge 8 && echo .bz2 || echo .gz)

%define mysql_paths __MYSQL_PATHS__
%define mysql_local %(test "%{mysql_paths}" != 0 && echo 1 || echo 0)
%define mysql_include %(echo "%{mysql_paths}" | cut -d: -f1)
%define mysql_lib %(echo "%{mysql_paths}" | cut -d: -f2)
# determine PCRE library based on distribution name
%define pcre_requires %(test %{build_dist} = mandrake && echo libpcre0 || echo pcre)
# determine SASL library based on distribution name
%define sasl_library %(test %{build_dist} = mandrake && echo libsasl-devel || echo cyrus-sasl-devel)
%define requires_db __REQUIRES_DB__
%define requires_zlib __REQUIRES_ZLIB__
%define smtpd_multiline_greeting __SMTPD_MULTILINE_GREETING__

# alternatives priority can now be changed in one place.
# - this used to be 30 but RH seems to have defined other higher values
#   and some users need another value.
#   Don't change this unless you really think you need to.
%define with_alt_prio     __WITH_ALT_PRIO__

%define with_cdb          __WITH_CDB__
%define with_ipv6         __WITH_IPV6__
%define with_ldap         __WITH_LDAP__
%define with_mysql        __WITH_MYSQL__
%define with_mysql_redhat __WITH_MYSQL_REDHAT__
%define with_pcre         __WITH_PCRE__
%define with_pgsql        __WITH_PGSQL__
%define with_sasl         __WITH_SASL__
%define with_spf          __WITH_SPF__
%define with_tls          __WITH_TLS__
%define with_tlsfix       __WITH_TLSFIX__
%define with_vda          __WITH_VDA__

# support the conditional builds via rpm's --with debug
%define debug %{?_with_debug:1}%{?!_with_debug:0}

# patch version information
%define V_vda   2.2.9
%define V_cdb   1.1.11-20021104

# If set to 1 if official version, 0 if snapshot
%define official 1
%define V_postfix 2.2.10
%define rel 3__SUFFIX__
%if %{official}
%define V_tarball %{V_postfix}
%define ftp_dir official
%else
%define V_release_date RC2
%define V_tarball %{V_postfix}-%{V_release_date}
%define ftp_dir experimental
%endif
# rpm does not accept '-' in version strings so replace them with a '.'
# - (only affects snapshots)
%define V_package %(echo %{V_tarball} | sed 's/-/./g')

# rpm-workaround:
#
# We can NOT use %{_docdir}/%{name}-%{version} for installing the docs
# from the 'install' section as RPM kindly removes this directory after
# we have installed files to it. (standard part of 'doc' processing!)
#
#define docdir %{_docdir}/%{name}-%{version}
%define docdir %{_docdir}/%{name}-%{V_package}-documentation
%define readme_dir   %{docdir}/readme
%define html_dir     %{docdir}/html
%define examples_dir %{docdir}/examples

%define newaliases_path %{_bindir}/newaliases.postfix
%define mailq_path %{_bindir}/mailq.postfix
%define rmail_path %{_bindir}/rmail.postfix
%define sendmail_path %{_sbindir}/sendmail.postfix
%define usrlib_sendmail %{_libdir}/sendmail.postfix

%define initdir /etc/rc.d/init.d

%define postfinger postfinger-1.29
%define whinge /usr/bin/logger -p mail.info -t postfix/rpm
%define die_cmd die(){ %whinge "$*"; exit 1; }

Name: postfix
Group: System Environment/Daemons
URL: http://www.postfix.org
License: IBM Public License
PreReq: chkconfig, initscripts, shadow-utils
PreReq: /etc/init.d, /sbin/service, chkconfig >= 1.3
Epoch: 2

Provides: MTA smtpd smtpdaemon
Provides: %{_sbindir}/sendmail %{_bindir}/mailq %{_bindir}/newaliases %{_bindir}/rmail
Provides: %{_mandir}/man1/newaliases.1.%{mps} %{_mandir}/man5/newaliases.5.%{mps}

Version: %{V_package}
Release: %{rel}
Packager: Simon J Mudd <sjmudd@pobox.com>
Summary: Postfix Mail Transport Agent
Vendor: Built on %{build_dist_full} (%{build_dist})
Source0: ftp://ftp.porcupine.org/mirrors/postfix-release/%{ftp_dir}/postfix-%{V_tarball}.tar.gz
Source1: make-postfix.rpm
Source2: postfix-get-distribution
Source3: postfix-etc-init.d-postfix
Source4: postfix-chroot.sh
Source5: postfix-aliases
Source7: postfix.spec.in
Source8: make-postfix.spec
Source10: README-Postfix-SASL-RedHat.txt
Source12: ftp://ftp.corpit.ru/pub/postfix/postfix-dict_cdb-%{V_cdb}.tar.gz
Source16: http://postfix.wl0.org/ftp/postfinger/%{postfinger}
# Sources >= 100 are config files
Source100: postfix-sasl.conf
Source101: postfix-pam.conf
Source102: postfix-saslauthd.conf

# Obligatory Patches
Patch3: postfix-files.patch
Patch5: postfix-makedefs.patch

# Optional patches
Patch4:  http://web.onda.com.br/nadal/postfix/VDA/postfix-%{V_vda}-vda.patch.gz
# Libspf patches
Patch6: http://www.ipnet6.org/postfix/spf/postfix-libspf2.README
Patch7: http://www.ipnet6.org/postfix/download/postfix-libspf2-2.2.0-5.patch
Patch8: http://www.linuxrulz.org/nkukard/postfix/postfix-2.2.10_libspf2-1.2.x-20060614.patch.gz
Patch99: ftp://ftp.wl0.org/SOURCES/postfix-2.0.16-20031026-multiline-greeting.patch
Patch100: postfix-2.2.1-smtpd_sasl_authenticated_header.patch
Patch101: postfix354-multiline.patch
Patch102: postfix354.patch

BuildRoot: %{_tmppath}/%{name}-%{V_package}-buildroot

# Determine packaging requirements
BuildRequires: /usr/bin/cc, gawk, sed, ed, patch, rpm >= 4
Requires: gawk, sed, ed

%if %{with_spf}
BuildRequires: libspf2-devel
Requires: libspf2
%endif

%if %{requires_db}
Requires: db%{requires_db}
BuildRequires: db%{requires_db}-devel
%endif

%if %{with_cdb}
Requires: tinycdb
BuildRequires: tinycdb
%endif

%if %{with_ldap}
Requires: openldap >= 1.2.9
BuildRequires: openldap-devel >= 1.2.9
%endif

%if %{with_pcre}
Requires: %{pcre_requires}
BuildRequires: %{pcre_requires}, %{pcre_requires}-devel
%endif

# Needed by some Mysql and some TLS packages
%if %{requires_zlib}
Requires: zlib
BuildRequires: zlib-devel
%endif

%if %{with_mysql_redhat}
Requires: mysql
BuildRequires: mysql, mysql-devel
%endif

%if %{mysql_local}
BuildRequires: %{mysql_include}/mysql.h
Requires: %{mysql_lib}/libmysqlclient.so
%endif

%if %{with_mysql}
Requires: MySQL-shared
BuildRequires: MySQL-shared, MySQL-devel
%endif

%if %{with_pgsql}
Requires: postgresql-libs
BuildRequires: postgresql-devel
%endif

%if %{with_sasl}
Requires: cyrus-sasl
BuildRequires: cyrus-sasl, %{sasl_library}
%endif

%if %{with_tls}
Requires: openssl
BuildRequires: openssl-devel
%endif

%description
Postfix is a Mail Transport Agent (MTA), intended to be an alternative
to the widely-used sendmail.  This package includes optional support for
LDAP, pcre, mysql, SMTP AUTH (SASL) and TLS.

See http://www.redhat.com/support/docs/faqs/RH-postfix-FAQ/book1.html,
a slightly outdated FAQ, which covers the steps involved in installing
and configuring postfix.

The binary and source rpms I produce are currently available at
	http://postfix.WL0.org, ftp://ftp.WL0.org
and the mirrors which can be found at the following URL:
	http://postfix.WL0.org/en/mirrors/

This package/specfile was built from postfix.spec.in $Revision: 2.304.4.37 $.
To see the build options used to build this package see the file %{_sysconfdir}/postfix/postfix.spec.cf

To use postfix with alternative options download the source package and
rebuild the binary package following the instructions in the source
package or on my web page.

%prep
umask 022

%{die_cmd}

# check custom MYSQL path values are sensible to avoid problems
# with people mixing include and lib directories
if [ "%{mysql_paths}" != 0 ]; then
	exit_error() {
		cat <<-EOF
		*************************************************************************
		CUSTOM MYSQL configuration error
		mysql_paths=%mysql_paths	(0=Not used)
		mysql_local=%mysql_local 	(0=Not used,1=used)
		mysql_include=%mysql_include	(include directory)
		mysql_lib=%mysql_lib		(lib directory)
		ERROR: $1
		        If you don't want to use a custom mysql installation set
			mysql_paths to 0.
		*************************************************************************
		EOF
		exit 1
	}
	[ $(echo "%{mysql_paths}" | awk -F: '{ print NF }') = 2 ] || \
		exit_error "mysql_paths should be of the form /pathto/mysql/include:/pathto/mysql/lib, with only 2 directories"
	echo "%{mysql_include}" | grep -q "/lib" && \
		exit_error "The first path in mysql_paths appears to be a library path: it should be an include path (e.g. /usr/local/include)"
	echo "%{mysql_lib}" | grep -q "/include" && \
		exit_error "The second path in mysql_paths appears to be an include path: it should be a library path (e.g. /usr/local/lib)"
fi

# Warn if the distribution this spec file was made for isn't the same as
# the current distribution, using a script in the SOURCES directory.
# This will be removed and built into the spec file later.

distribution=$(sh $(rpm --eval '%{_sourcedir}')/postfix-get-distribution)

if [ "${distribution}" != "%{distribution}" ]; then
    cat <<ENDTEXT
ERROR ERROR ERROR ERROR ERROR ERROR ERROR ERROR ERROR ERROR ERROR ERROR

This postfix.spec file may not work correctly.
It was built for %{distribution}, while you are running ${distribution}.

Please rebuild postfix.spec for your distribution by following the
instructions in postfix.spec.cf.

If this procedure does not allow you to produce a working package, please
let me know.

ERROR ERROR ERROR ERROR ERROR ERROR ERROR ERROR ERROR ERROR ERROR ERROR
ENDTEXT
	exit 1
fi

%setup -q -n postfix-%{V_tarball}

# Apply obligatory patches
%patch3 -p1 -b .alternatives
%patch5 -p1 -b .notls

# Apply optional patches
%if %{with_cdb}
%setup -n postfix-%{V_tarball} -D -T -a 12
sh dict_cdb.sh
%endif

%if %{with_vda}
  test -e  %{_sourcedir}/postfix-%{V_vda}-vda.patch.gz && \
  gzip -dc %{_sourcedir}/postfix-%{V_vda}-vda.patch.gz | patch -p1 -b --suffix .vda -s || \
    die "%{_sourcedir}/postfix-%{V_vda}-vda.patch.gz not found or patch failed"
%endif

# REMINDER: perhaps these should be incorporated into one patch?
%if %{smtpd_multiline_greeting}
%patch99  -p1 -b .multiline
%patch101 -p1 -b .354-multilinepatch
%endif

%if %{with_spf}
if [ "%{with_spf}" -le 1 ]; then
%patch7 -p1 -b .spf
else
%patch8 -p1 -b .spf
+ fi
%endif

%patch100 -p1 -b .saslauthheader
%patch102 -p1 -b .354patch

# Modify master.cf: rmail --> rmail.postfix
ed conf/master.cf <<EOF || exit 1
%s/rmail/rmail.postfix/
w
q
EOF

%build
umask 022

CCARGS=
AUXLIBS=

%ifarch s390 s390x ppc
CCARGS="${CCARGS} -fsigned-char"
%endif

%if %{with_cdb}
  CCARGS="${CCARGS} -DHAS_CDB"
  AUXLIBS="${AUXLIBS} -lcdb"
%endif

%if %{with_ldap}
  CCARGS="${CCARGS} -DHAS_LDAP"
  AUXLIBS="${AUXLIBS} -L/usr/%{_lib} -lldap -llber"
%endif

%if %{with_pcre}
  # -I option required for pcre 3.4 (and later?)
  CCARGS="${CCARGS} -DHAS_PCRE -I/usr/include/pcre"
  AUXLIBS="${AUXLIBS} -lpcre"
%else
  # we need to explicitly disable pcre unless asked for, otherwise it will
  # be included if present on the build system. This may cause problems.
  CCARGS="${CCARGS} -DNO_PCRE"
%endif

# Postfix compiles without needing zlib on RedHat's mysql package, but
# requires zlib when using MySQL's package or if using a locally installed
# MySQL binary.
%if %{with_mysql} || %{with_mysql_redhat}
  CCARGS="${CCARGS} -DHAS_MYSQL -I/usr/include/mysql"
  AUXLIBS="${AUXLIBS} -L/usr/%{_lib}/mysql -lmysqlclient -lm"
%endif

%if %{mysql_local}
  CCARGS="${CCARGS} -DHAS_MYSQL -I%{mysql_include}"
  AUXLIBS="${AUXLIBS} -L%{mysql_lib} -lmysqlclient -lm"
%endif

%if %{with_pgsql}
  CCARGS="${CCARGS} -DHAS_PGSQL -I/usr/include/pgsql"
  AUXLIBS="${AUXLIBS} -lpq -lcrypt"
%endif

%if %{with_sasl}
  if [ "%{with_sasl}" -le 1 ]; then
    %define sasl_lib_dir %{_libdir}/sasl
    CCARGS="${CCARGS} -DUSE_SASL_AUTH"
    AUXLIBS="${AUXLIBS} -L%{sasl_lib_dir} -lsasl"
  else
    %define sasl_lib_dir %{_libdir}/sasl2
    CCARGS="${CCARGS} -I/usr/include/sasl -DUSE_SASL_AUTH"
    AUXLIBS="${AUXLIBS} -L%{sasl_lib_dir} -lsasl2"
  fi
%endif

%if %{with_spf}
  if [ "%{with_spf}" -le 1]; then
    AUXLIBS="${AUXLIBS} -lspf2"
  else
    AUXLIBS="${AUXLIBS} -lspf2"
    CCARGS="${CCARGS} -DHAVE_NS_TYPE"
  fi
%endif

%if %{with_tls}
# See http://www.openldap.org/lists/openldap-devel/200105/msg00008.html
# - rh6.2 needs LIBS=-ldl to build correctly.
# - reported by Jauder Ho <jauderho@carumba.com>
  if pkg-config openssl; then
    CCARGS="${CCARGS} -DUSE_TLS $(pkg-config --cflags openssl)"
    AUXLIBS="${AUXLIBS} $(pkg-config --libs openssl)"
  else
    #
    # CHECK THIS - these lines may no longer be needed (required for external TLS patch)
    #
    [ "%{with_tlsfix}" = 1 ] && LIBS=-ldl
    [ "%{with_tlsfix}" = 2 ] && CCARGS="${CCARGS} -I/usr/kerberos/include"
    CCARGS="${CCARGS} -DUSE_TLS -I/usr/include/openssl"
    AUXLIBS="${AUXLIBS} -lssl -lcrypto"
  fi
%else
# explicitly disable TLS otherwise will be built on machine if
# openssl is available
	CCARGS="${CCARGS} -DNO_TLS"
%endif

# Required by some TLS implementations (RHEL 3 and RH9) and also some
# MySQL packages
%if %{requires_zlib}
  AUXLIBS="${AUXLIBS} -lz"
%endif

export CCARGS AUXLIBS
make -f Makefile.init makefiles
unset CCARGS AUXLIBS
make DEBUG="%{?_with_debug:-g}" OPT="$RPM_OPT_FLAGS"

%pre
umask 022

# create postfix user and group, and maildrop group if necessary.
# Use perl rather than looking in /etc/passwd or /etc/group as this works
# in a wider NIS or LDAP environment

/usr/bin/getent group postdrop >/dev/null || {
    %whinge "Adding postdrop group to system"
    %{_sbindir}/groupadd -r postdrop
}

/usr/bin/getent group postfix >/dev/null || {
    %whinge "Adding postfix group to system"
    %{_sbindir}/groupadd -r postfix
}

/usr/bin/getent passwd postfix >/dev/null || {
    %whinge "Adding postfix user to system"
    %{_sbindir}/useradd -d %{_var}/spool/postfix -s /bin/true -g postfix -G mail -M -r postfix
}

# If Postfix is not a member of the mail group (it wasn't in older versions of
# my package) add it to the group.  This is needed for people using cyrus,
# linked by unix sockets (amongst other things)
GROUP=$(id postfix | awk '{print $3}' | sed -e 's/groups=//' | grep mail)
test -z "${GROUP}" && usermod -G mail postfix || :

# check for a new install and see if a non package installed Postfix might
# exist.  Attempt to avoid overwriting the source config and provide a warning.
if [ $1 = 0 ]; then
    timenow=$(date +%Y%m%d-%H%M%S)
    pretext="This is a new Postfix RPM installation"
    [ -f %{_sysconfdir}/postfix ] && {
        [ -n "$pretext" ] && %whinge "$pretext" && pretext=
        %whinge "Detected a possible previous non-RPM install in %{_sysconfdir}/postfix."
        %whinge "- going to move it out of the way to %{_sysconfdir}/postfix.$timenow."
        mv %{_sysconfdir}/postfix %{_sysconfdir}/postfix.$timenow
    }
    [ -d %{initdir}/postfix ] && {
        [ -n "$pretext" ] && %whinge "$pretext" && pretext=
        %whinge "Detected a possible previous non-RPM startup script %{initdir}/postfix."
        %whinge "- going to move it out of the way to %{initdir}/postfix.$timenow."
        mv %{initdir}/postfix %{initdir}/postfix.$timenow
    }
fi

exit 0

%install
umask 022

[ -n "${RPM_BUILD_ROOT}" -a "${RPM_BUILD_ROOT}" != "/" ] && {
    rm -rf   ${RPM_BUILD_ROOT}
    mkdir -p ${RPM_BUILD_ROOT}
}

%{?!debug:strip -R .comment --strip-unneeded bin/* libexec/*}

# rename man pages which may conflict with sendmail's
mv man/man1/mailq.1      man/man1/mailq.postfix.1
mv man/man1/newaliases.1 man/man1/newaliases.postfix.1
mv man/man1/sendmail.1   man/man1/sendmail.postfix.1
mv man/man5/aliases.5    man/man5/aliases.postfix.5

# add missing man pages
mantools/srctoman - auxiliary/qshape/qshape.pl >man/man1/qshape.1
mantools/srctoman src/smtpstone/smtp-source.c  >man/man1/smtp-source.1
mantools/srctoman src/smtpstone/smtp-sink.c    >man/man1/smtp-sink.1

# update conf/postfix-files
cat <<EOF >> conf/postfix-files
\$manpage_directory/man1/qshape.1:f:root:-:644
\$manpage_directory/man1/smtp-sink.1:f:root:-:644
\$manpage_directory/man1/smtp-source.1:f:root:-:644
EOF

# install postfix into build root
sh postfix-install -non-interactive \
       install_root=${RPM_BUILD_ROOT} \
       config_directory=%{_sysconfdir}/postfix \
       daemon_directory=%{_libexecdir}/postfix \
       command_directory=%{_sbindir} \
       queue_directory=%{_var}/spool/postfix \
       sendmail_path=%{sendmail_path} \
       newaliases_path=%{newaliases_path} \
       mailq_path=%{mailq_path} \
       mail_owner=postfix \
       setgid_group=postdrop \
       html_directory=%{html_dir} \
       manpage_directory=%{_mandir} \
       readme_directory=%{readme_dir} || exit 1

# To be compatible with later versions of RH sendmail/postfix packages
# make /usr/lib/sendmail.postfix point to /usr/sbin/sendmail.postfix.
# The alternatives then point /usr/lib/sendmail to /usr/lib/sendmail.postfix.
# This *is* all a bit silly ...

install -d -m755 $RPM_BUILD_ROOT%{_libdir}
ln -sf ../sbin/sendmail.postfix $RPM_BUILD_ROOT%{usrlib_sendmail}

# RPM compresses man pages automatically.  Edit postfix-files to avoid
# confusing post-install.
ed ${RPM_BUILD_ROOT}%{_sysconfdir}/postfix/postfix-files <<EOF || exit 1
%s/\(\/man[158]\/.*\.[158]\):/\1%{mps}:/
w
q
EOF

# Change alias_maps and alias_database default directory to use
# %{_sysconfdir}/postfix
bin/postconf -c ${RPM_BUILD_ROOT}%{_sysconfdir}/postfix -e \
	"alias_maps = hash:%{_sysconfdir}/postfix/aliases" \
	"alias_database = hash:%{_sysconfdir}/postfix/aliases" \
|| exit 1

# Install Sys V init script
mkdir -p ${RPM_BUILD_ROOT}%{initdir}
install -c %{_sourcedir}/postfix-etc-init.d-postfix \
                  ${RPM_BUILD_ROOT}%{initdir}/postfix

install -c auxiliary/rmail/rmail ${RPM_BUILD_ROOT}%{rmail_path}
install -c auxiliary/qshape/qshape.pl ${RPM_BUILD_ROOT}/%{_sbindir}/qshape

# copy new aliases files and generate a ghost aliases.db file
cp -f %{_sourcedir}/postfix-aliases ${RPM_BUILD_ROOT}%{_sysconfdir}/postfix/aliases
chmod 644 ${RPM_BUILD_ROOT}%{_sysconfdir}/postfix/aliases

touch ${RPM_BUILD_ROOT}/%{_sysconfdir}/postfix/aliases.db

for i in active bounce corrupt defer deferred flush incoming private saved \
         hold maildrop public pid; do
    mkdir -p ${RPM_BUILD_ROOT}%{_var}/spool/postfix/$i
done

# install qmqp-source, smtp-sink & smtp-source by hand
for i in qmqp-source smtp-sink smtp-source; do
  install -c -m 755 bin/$i ${RPM_BUILD_ROOT}%{_sbindir}/$i
done

# install postfinger and postfix-chroot.sh scripts
# - postfix-chroot.sh is placed in /etc/postfix to make it more visible
install -c -m 755 %{_sourcedir}/%{postfinger} ${RPM_BUILD_ROOT}%{_bindir}/postfinger
install -c -m 755 %{_sourcedir}/postfix-chroot.sh ${RPM_BUILD_ROOT}%{_sysconfdir}/postfix/

[ -d "${RPM_BUILD_ROOT}%{html_dir}" ]     || mkdir -p ${RPM_BUILD_ROOT}%{html_dir}
[ -d "${RPM_BUILD_ROOT}%{readme_dir}" ]   || mkdir -p ${RPM_BUILD_ROOT}%{readme_dir}
install -c -m 644 %{_sourcedir}/README-Postfix-SASL-RedHat.txt ${RPM_BUILD_ROOT}%{readme_dir}/
[ -d "${RPM_BUILD_ROOT}%{examples_dir}" ] || mkdir -p ${RPM_BUILD_ROOT}%{examples_dir}
cp -pr examples/* ${RPM_BUILD_ROOT}%{examples_dir}/
# disable execution permissions to avoid rpm generating dependencies
find ${RPM_BUILD_ROOT}%{examples_dir}/ -type f -exec chmod -x {} \;

# Install odd documentation files
for file in AAAREADME COMPATIBILITY COPYRIGHT HISTORY PORTING \
	RELEASE_NOTES RELEASE_NOTES-1.1 RELEASE_NOTES-2.0 \
	US_PATENT_6321267
do
	install -c -m 644 $file ${RPM_BUILD_ROOT}%{docdir}/
done
cat <<EOF >${RPM_BUILD_ROOT}%{docdir}/SEE-ALSO
%{_docdir}/%{name}-%{version} may contain other documentation files.
EOF

# added for convenience
ln -sf %{html_dir}     ${RPM_BUILD_ROOT}%{_sysconfdir}/postfix/html
ln -sf %{readme_dir}   ${RPM_BUILD_ROOT}%{_sysconfdir}/postfix/readme
ln -sf %{examples_dir} ${RPM_BUILD_ROOT}%{_sysconfdir}/postfix/examples

# Install the smtpd.conf file for SASL support.
%if %{with_sasl}
mkdir -p ${RPM_BUILD_ROOT}%{sasl_lib_dir}
install -m 644 %SOURCE100 ${RPM_BUILD_ROOT}%{sasl_lib_dir}/smtpd.conf
mkdir -p $RPM_BUILD_ROOT%{_sysconfdir}/pam.d
install -m 644 %SOURCE101 ${RPM_BUILD_ROOT}%{_sysconfdir}/pam.d/smtp.postfix
mkdir -p $RPM_BUILD_ROOT%{_sysconfdir}/sysconfig
install -m 644 %SOURCE102 ${RPM_BUILD_ROOT}%{_sysconfdir}/sysconfig/saslauthd.postfix
%endif

# Include README.rpm explaining where the documentation can be found and
# also pointing out how to get updated copies of my package
cat <<EOF > ${RPM_BUILD_ROOT}%{_sysconfdir}/postfix/README.rpm
README.rpm
==========

Documentation
-------------

Postfix documentation should be available in the directory %{docdir}/.
I have also added a symbolic link to the readme_files and html
directories from %{_sysconfdir}/postfix.

The main Postfix web site is http://www.postfix.org.

Packages
--------

Newer versions of source and standard binary packages may be available from
http://ftp.WL0.org or the mirrors listed at http://postfix.WL0.org.  Look
in the appropriate directory according to your distribution.

Mailing List
------------

I host a mailing list to announce new packages as they are released. If you
are interested in subscribing take a look at
http://postfix.WL0.org/en/lists/.  Previous announcements are archived.

Chrooting
---------

The chroot behaviour of my packages has changed over time. Current
packages will NOT turn on the chroot environment in Postfix.  Older
versions did the opposite.  If you upgrade from an older version
of my package the chroot behaviour will NOT be changed. (Check
%{_sysconfdir}/postfix/master.cf for details.)

I have provided a simple script postfix-chroot.sh which attempts to
cover most situations and should enable you to disable or enable the
chroot on your system with little effort.

Package Build Options
---------------------

This package can be built on several Linux distributions and with several
optional features.  %{_sysconfdir}/postfix/postfix.spec.cf contains the 
information used to build this version of the rpm. It can also
be used to build a new rpm with the same options.

Enjoy!

Simon J Mudd, <sjmudd@pobox.com>
EOF

# generate postfix.spec.cf
# - used to build a newer version of the rpm with the same parameters
#   as the current package.
# - provides build instructions
cat - %{_sourcedir}/postfix.spec.cf <<EOF | sed -e '/^# NOTE:/d' > ${RPM_BUILD_ROOT}%{_sysconfdir}/postfix/postfix.spec.cf
#
# This file contains the following information:
#
# - configuration options used to build the installed postfix rpm
#   - generated when the binary rpm was built
#
# - Postfix RPM build instructions
#   - for upgrading the installed rpm with the same options
#   - for building the rpm with other options
#
# 1. CONFIGURATION OPTIONS OF INSTALLED BINARY RPM
#
# Package built on: %{build_dist_full} (%{build_dist})

POSTFIX_ALT_PRIO=%{with_alt_prio}
POSTFIX_CDB=%{with_cdb}
POSTFIX_DB=%{requires_db}
POSTFIX_IPV6=%{with_ipv6}
POSTFIX_LDAP=%{with_ldap}
POSTFIX_MYSQL=%{with_mysql}
POSTFIX_MYSQL_PATHS=%{mysql_paths}
POSTFIX_MYSQL_REDHAT=%{with_mysql_redhat}
POSTFIX_PCRE=%{with_pcre}
POSTFIX_PGSQL=%{with_pgsql}
POSTFIX_SASL=%{with_sasl}
POSTFIX_SMTPD_MULTILINE_GREETING=%{smtpd_multiline_greeting}
POSTFIX_SPF=%{with_spf}
POSTFIX_TLS=%{with_tls}
POSTFIX_VDA=%{with_vda}

# export values to child processes
export POSTFIX_MYSQL POSTFIX_MYSQL_PATHS POSTFIX_MYSQL_REDHAT \
 POSTFIX_LDAP POSTFIX_PCRE POSTFIX_PGSQL \
 POSTFIX_SASL POSTFIX_SPF POSTFIX_TLS POSTFIX_IPV6 POSTFIX_VDA \
 POSTFIX_SMTPD_MULTILINE_GREETING POSTFIX_DB POSTFIX_INCLUDE_DB \
 POSTFIX_CDB POSTFIX_ALT_PRIO

# other options used in the build (but not explicitly changeable by the user) are:
# - debug=%{?_with_debug:1}%{?!_with_debug:0}
# - pcre_requires=%{pcre_requires},
# - requires_zlib=%{requires_zlib},
# - sasl_library=%{sasl_library}
# - tlsfix=%{with_tlsfix}
#
# %{_sysconfdir}/postfix/makedefs.out is also produced by the build and may be of
# interest if you are building Postfix by hand.
EOF

%post
umask 022

chkconfig --add postfix

# upgrade configuration files if necessary
sh %{_sysconfdir}/postfix/post-install upgrade-package \
	config_directory=%{_sysconfdir}/postfix \
	daemon_directory=%{_libexecdir}/postfix \
	command_directory=%{_sbindir} \
	mail_owner=postfix \
	setgid_group=postdrop \
	html_directory=%{html_dir} \
	manpage_directory=%{_mandir} \
	readme_directory=%{readme_dir} \
	sendmail_path=%{sendmail_path} \
	newaliases_path=%{newaliases_path} \
	mailq_path=%{mailq_path} \
|| :

%{_sbindir}/postalias %{_sysconfdir}/postfix/aliases
%{_sbindir}/postfix check || :

# Add submission to services if not found, required for rh <= 7.0
if ! grep -q ^submission %{_sysconfdir}/services
then
cat <<EOF >>%{_sysconfdir}/services
submission	587/tcp		msa	# mail message submission
submission	587/udp		msa	# mail message submission
EOF
fi

# Add smtps to services if not found
if ! grep -q ^smtps %{_sysconfdir}/services
then
cat <<EOF >>%{_sysconfdir}/services
smtps		465/tcp			# SMTP over SSL (TLS)
EOF
fi

# If using sasl create %{_sysconfdir}/sysconfig/saslauthd if necessary
# - this file is provided in some (but not all) cyrus-sasl packages
#   - RHEL3 provides this file in cyrus-sasl >= 2.1.18-2
%if %{with_sasl}
[ -f %{_sysconfdir}/sysconfig/saslauthd ] || {
	grep -v "^# NOTE: " %{_sysconfdir}/sysconfig/saslauthd.postfix > %{_sysconfdir}/sysconfig/saslauthd
	chmod 644 %{_sysconfdir}/sysconfig/saslauthd
	%{whinge} "creating new %{_sysconfdir}/sysconfig/saslauthd from local Postfix copy"
}
%endif

# Apply the alternatives scripts ONLY if installing (not upgrading) to
# ensure a link exists from %{_sbindir}/sendmail to
# %{sendmail_path} (and other files).
#
# If performing an upgrade this MUST be done in the trigger scripts.
# (old postfix packages, pre-alternatives have a /usr/sbin/sendmail and this
# gets removed _AFTER_ the %post stage when the old package is removed)

[ "$1" = 1 ] || exit 0

# See changelog for explanation of mta-sendmailman entry.
%{_sbindir}/alternatives --install %{_sbindir}/sendmail mta %{sendmail_path} %{with_alt_prio} \
    --slave %{_bindir}/mailq mta-mailq %{mailq_path} \
    --slave %{_bindir}/newaliases mta-newaliases %{newaliases_path} \
    --slave %{_bindir}/rmail mta-rmail %{rmail_path} \
    --slave %{_libdir}/sendmail mta-sendmail %{usrlib_sendmail} \
    --slave %{_mandir}/man8/sendmail.8%{mps}   mta-sendmailman   %{_mandir}/man1/sendmail.postfix.1%{mps} \
    --slave %{_mandir}/man1/mailq.1%{mps}      mta-mailqman      %{_mandir}/man1/mailq.postfix.1%{mps} \
    --slave %{_mandir}/man1/newaliases.1%{mps} mta-newaliasesman %{_mandir}/man1/newaliases.postfix.1%{mps} \
    --slave %{_mandir}/man5/aliases.5%{mps}    mta-aliasesman    %{_mandir}/man5/aliases.postfix.5%{mps} \
    --initscript postfix

exit 0

%triggerpostun -- sendmail

# If removing sendmail and not using alternatives: replace with postfix equivalents
%whinge "%{V_postfix}-%{rel} triggerpostun -- sendmail: final number of sendmail packages=$2"
[ $2 = 0 ] || exit 0

# See changelog for explanation of mta-sendmailman entry.
%{_sbindir}/alternatives --install %{_sbindir}/sendmail mta %{sendmail_path} %{with_alt_prio} \
    --slave %{_bindir}/mailq mta-mailq %{mailq_path} \
    --slave %{_bindir}/newaliases mta-newaliases %{newaliases_path} \
    --slave %{_bindir}/rmail mta-rmail %{rmail_path} \
    --slave %{_libdir}/sendmail mta-sendmail %{usrlib_sendmail} \
    --slave %{_mandir}/man8/sendmail.8%{mps}   mta-sendmailman   %{_mandir}/man1/sendmail.postfix.1%{mps} \
    --slave %{_mandir}/man1/mailq.1%{mps}      mta-mailqman      %{_mandir}/man1/mailq.postfix.1%{mps} \
    --slave %{_mandir}/man1/newaliases.1%{mps} mta-newaliasesman %{_mandir}/man1/newaliases.postfix.1%{mps} \
    --slave %{_mandir}/man5/aliases.5%{mps}    mta-aliasesman    %{_mandir}/man5/aliases.postfix.5%{mps} \
    --initscript postfix
exit 0	# ensure the trigger exit status is 0

%triggerpostun -- postfix

# If upgrading postfix some versions are pre-alternatives and use
# /usr/sbin/sendmail.  After uninstalling the old package this file will be
# missing and we need to link to the new postfix sendmail binary.
%whinge "%{V_postfix}-%{rel} triggerpostun -- postfix: final number of Postfix packages=$2"
[ $2 -gt 0 ] || exit 0

# See changelog for explanation of mta-sendmailman entry.
%{_sbindir}/alternatives --install %{_sbindir}/sendmail mta %{sendmail_path} %{with_alt_prio} \
    --slave %{_bindir}/mailq mta-mailq %{mailq_path} \
    --slave %{_bindir}/newaliases mta-newaliases %{newaliases_path} \
    --slave %{_bindir}/rmail mta-rmail %{rmail_path} \
    --slave %{_libdir}/sendmail mta-sendmail %{usrlib_sendmail} \
    --slave %{_mandir}/man8/sendmail.8%{mps}   mta-sendmailman   %{_mandir}/man1/sendmail.postfix.1%{mps} \
    --slave %{_mandir}/man1/mailq.1%{mps}      mta-mailqman      %{_mandir}/man1/mailq.postfix.1%{mps} \
    --slave %{_mandir}/man1/newaliases.1%{mps} mta-newaliasesman %{_mandir}/man1/newaliases.postfix.1%{mps} \
    --slave %{_mandir}/man5/aliases.5%{mps}    mta-aliasesman    %{_mandir}/man5/aliases.postfix.5%{mps} \
    --initscript postfix
exit 0	# ensure the trigger exit status is 0

%preun
umask 022

# remove the directory and depth levels of subdirectories

queue_hash_depth_remove () {
    local dir=$1
    local depth=$2
    local new_depth
    local a
    [ -d "$dir" ] && {
        if [ "$depth" -gt 0 ]; then
            new_depth=$(($depth - 1))
            for a in 0 1 2 3 4 5 6 7 8 9 A B C D E F; do
                test -d $dir/$a && queue_hash_depth_remove $dir/$a $new_depth
            done
        fi
        rm -f $dir/*
        rmdir $dir || %whinge "WARNING: preun - unable to remove directory %{_var}/spool/postfix/$dir"
    }
}

# remove the rest of the queue directory structure
queue_directory_remove () {
    # remove the hashed directories
    depth=$(postconf -h hash_queue_depth)
    for dir in $(postconf -h hash_queue_names | sed -e 's/,/\n/g; s/ //g'); do
        queue_hash_depth_remove $dir $depth
    done

    # now remove the other directories
    for dir in corrupt hold maildrop pid private public saved; do
        queue_hash_depth_remove $dir 0
    done
}

# No more postfix packages left so prepare to finish package removal.
# _In theory_ there is no chroot environment now, so there is no need to
# clean it out.
# However it may be prudent later to add back a call to
# /etc/postfix/postfix-chroot.sh disable
# just to make sure, but won't do this yet. (If you think I should let
# me know).
if [ "$1" = 0 ]; then
    service postfix stop >/dev/null 2>&1
    chkconfig --del postfix

    %{_sbindir}/alternatives --remove mta %{sendmail_path}

    # userdel also deletes the user's group
    %{_sbindir}/userdel postfix   || %whinge "WARNING: failed to remove user postfix"
    %{_sbindir}/groupdel postdrop || %whinge "WARNING: failed to remove group postdrop"

    cd %{_var}/spool/postfix && queue_directory_remove
fi

exit 0

%postun
umask 022
if [ "$1" -ge 1 ]; then
    service postfix condrestart || :
    # don't use readlink as this is not available on rh73
    mta=`[ -L /etc/alternatives/mta ] && ls -la /etc/alternatives/mta | awk '{ print $11 }'`
    if [ "$mta" = "%{sendmail_path}" ]; then
        %{_sbindir}/alternatives --set mta %{sendmail_path}
    fi
fi
exit 0

%clean
umask 022
[ -n "${RPM_BUILD_ROOT}" -a "${RPM_BUILD_ROOT}" != "/" ] && {
    rm -rf ${RPM_BUILD_ROOT}
} || :

%files
%defattr(-, root, root)

%if %{with_sasl}
%config(noreplace) %{sasl_lib_dir}/smtpd.conf
%config(noreplace) %{_sysconfdir}/pam.d/smtp.postfix
%config(noreplace) %{_sysconfdir}/sysconfig/saslauthd.postfix
%endif

%verify(not md5 size mtime) %config %dir %{_sysconfdir}/postfix
%attr(0644, root, root)         %{_sysconfdir}/postfix/LICENSE
%attr(0644, root, root)         %{_sysconfdir}/postfix/TLS_LICENSE
%attr(0755, root, root) %config %{_sysconfdir}/postfix/postfix-script
%attr(0755, root, root) %config %{_sysconfdir}/postfix/post-install
%attr(0444, root, root) %config %{_sysconfdir}/postfix/makedefs.out
%attr(0644, root, root)                                                %{_sysconfdir}/postfix/postfix-files
%attr(0644, root, root) %verify(not md5 size mtime) %config(noreplace) %{_sysconfdir}/postfix/main.cf
%attr(0644, root, root)                                                %{_sysconfdir}/postfix/main.cf.default
%attr(0644, root, root) %verify(not md5 size mtime) %config(noreplace) %{_sysconfdir}/postfix/master.cf
%attr(0644, root, root) %verify(not md5 size mtime) %config(noreplace) %{_sysconfdir}/postfix/access
%attr(0644, root, root) %verify(not md5 size mtime) %config(noreplace) %{_sysconfdir}/postfix/aliases
%attr(0644, root, root) %verify(not md5 size mtime) %ghost             %{_sysconfdir}/postfix/aliases.db
%attr(0644, root, root) %verify(not md5 size mtime) %config(noreplace) %{_sysconfdir}/postfix/canonical
%attr(0644, root, root) %verify(not md5 size mtime) %config(noreplace) %{_sysconfdir}/postfix/generic
%attr(0644, root, root) %verify(not md5 size mtime) %config(noreplace) %{_sysconfdir}/postfix/header_checks
%attr(0644, root, root) %verify(not md5 size mtime) %config(noreplace) %{_sysconfdir}/postfix/relocated
%attr(0644, root, root) %verify(not md5 size mtime) %config(noreplace) %{_sysconfdir}/postfix/transport
%attr(0644, root, root) %verify(not md5 size mtime) %config(noreplace) %{_sysconfdir}/postfix/virtual

%attr(0644, root, root) %{_sysconfdir}/postfix/README.rpm
%attr(0644, root, root) %{_sysconfdir}/postfix/postfix.spec.cf

# convenience links
%{_sysconfdir}/postfix/html
%{_sysconfdir}/postfix/readme
%{_sysconfdir}/postfix/examples

%attr(0755, root, root) %{_sysconfdir}/postfix/postfix-chroot.sh

%attr(0755, root, root) %config %{initdir}/postfix

%dir                      %verify(not md5 size mtime) %{_var}/spool/postfix

# For correct directory permissions check postfix-install script
%dir %attr(0700, postfix, root)     %verify(not md5 size mtime) %{_var}/spool/postfix/active
%dir %attr(0700, postfix, root)     %verify(not md5 size mtime) %{_var}/spool/postfix/bounce
%dir %attr(0700, postfix, root)     %verify(not md5 size mtime) %{_var}/spool/postfix/corrupt
%dir %attr(0700, postfix, root)     %verify(not md5 size mtime) %{_var}/spool/postfix/defer
%dir %attr(0700, postfix, root)     %verify(not md5 size mtime) %{_var}/spool/postfix/deferred
%dir %attr(0700, postfix, root)     %verify(not md5 size mtime) %{_var}/spool/postfix/flush
%dir %attr(0700, postfix, root)     %verify(not md5 size mtime) %{_var}/spool/postfix/hold
%dir %attr(0700, postfix, root)     %verify(not md5 size mtime) %{_var}/spool/postfix/incoming
%dir %attr(0700, postfix, root)     %verify(not md5 size mtime) %{_var}/spool/postfix/private
%dir %attr(0700, postfix, root)     %verify(not md5 size mtime) %{_var}/spool/postfix/saved
%dir %attr(0730, postfix, postdrop) %verify(not md5 size mtime) %{_var}/spool/postfix/maildrop
%dir %attr(0710, postfix, postdrop) %verify(not md5 size mtime) %{_var}/spool/postfix/public
%dir %attr(0755, root, root)        %verify(not md5 size mtime) %{_var}/spool/postfix/pid

%doc %{docdir}/AAAREADME
%doc %{docdir}/COMPATIBILITY
%doc %{docdir}/COPYRIGHT
%doc %{docdir}/HISTORY
%doc %{docdir}/PORTING
%doc %{docdir}/RELEASE_NOTES
%doc %{docdir}/RELEASE_NOTES-1.1
%doc %{docdir}/RELEASE_NOTES-2.0
%doc %{docdir}/SEE-ALSO
%doc %{docdir}/US_PATENT_6321267

%doc %dir %{readme_dir}
%doc %{readme_dir}/*
%doc %dir %{html_dir}
%doc %{html_dir}/*
%doc %dir %{examples_dir}
%doc %dir %{examples_dir}/chroot-setup
%dir %dir %{examples_dir}/qmail-local
%dir %dir %{examples_dir}/smtpd-policy
%doc %{examples_dir}/chroot-setup/*
%doc %{examples_dir}/qmail-local/*
%doc %{examples_dir}/smtpd-policy/*

%dir %attr(0755, root, root) %verify(not md5 size mtime) %{_libexecdir}/postfix
%{_libexecdir}/postfix/anvil
%{_libexecdir}/postfix/bounce
%{_libexecdir}/postfix/cleanup
%{_libexecdir}/postfix/discard
%{_libexecdir}/postfix/error
%{_libexecdir}/postfix/flush
%{_libexecdir}/postfix/lmtp
%{_libexecdir}/postfix/local
%{_libexecdir}/postfix/master
%{_libexecdir}/postfix/nqmgr
%{_libexecdir}/postfix/oqmgr
%{_libexecdir}/postfix/pickup
%{_libexecdir}/postfix/pipe
%{_libexecdir}/postfix/proxymap
%{_libexecdir}/postfix/qmgr
%{_libexecdir}/postfix/qmqpd
# including as installed by Wietse even with -DNO_TLS ?
%{_libexecdir}/postfix/scache
%{_libexecdir}/postfix/showq
%{_libexecdir}/postfix/smtp
%{_libexecdir}/postfix/smtpd
%{_libexecdir}/postfix/spawn
# including as installed by Wietse even with -DNO_TLS ?
%{_libexecdir}/postfix/tlsmgr
%{_libexecdir}/postfix/trivial-rewrite
%{_libexecdir}/postfix/verify
%{_libexecdir}/postfix/virtual

%{_sbindir}/postalias
%{_sbindir}/postcat
%{_sbindir}/postconf
%attr(2755,root,postdrop) %{_sbindir}/postdrop
%attr(2755,root,postdrop) %{_sbindir}/postqueue
%{_sbindir}/postfix
%{_sbindir}/postkick
%{_sbindir}/postlock
%{_sbindir}/postlog
%{_sbindir}/postmap
%{_sbindir}/postsuper

%{_sbindir}/smtp-sink
%{_sbindir}/smtp-source
%{_sbindir}/qmqp-source

%{sendmail_path}
%{mailq_path}
%{newaliases_path}
%{usrlib_sendmail}
%attr(0755, root, root) %{rmail_path}
%attr(0755, root, root) %{_bindir}/postfinger
%attr(0755, root, root) %{_sbindir}/qshape

%{_mandir}/*/*

##############################################################################
# List of changes made to this package.
#
# Although old entries from the changelog have been removed most of them
# are available from my CVS repository of changes made to this file.
#

%changelog

* Thu Jun 15 2006 Simon J Mudd <sjmudd@pobox.com> 2.2.10-3
  - updated libspf patch from Eric Hoeve <eric@ehoeve.com>

* Fri Apr 07 2006 Simon J Mudd <sjmudd@pobox.com> 2.2.10-2
  - adjust to 2.2.10
  - adjust postfix-get-distribution to work better

* Tue Mar 21 2006 Simon J Mudd <sjmudd@pobox.com> 2.2.9-3
  - use only chkconfig (/usr/sbin/alternatives) on supported packages.
    This contrasts previous support for boxes which did not have this.
    However as of rh7.3 and later chkconfig includes /usr/sbin/alternatives
    so I can simplify the rpm.  Only gotcha to be aware of *may* be old
    /usr/lib/sendmail "links", but they should be ok.
  - 'fix' mta-sendmailman entry so that alternatives does not complain.
    The link is wrong but ensures that my RPM will install correctly without
    change when the system sendmail is installed.

* Mon Mar 20 2006 Simon J Mudd <sjmudd@pobox.com> 2.2.9-2
  - update vda patch to 2.2.9

* Mon Feb 27 2006 Simon J Mudd <sjmudd@pobox.com> 2.2.9-1
  - update to 2.2.9

* Sat Jan 14 2006 Simon J Mudd <sjmudd@pobox.com> 2.2.8-4
  - several additions suggested by Tony Earnshaw <tonye@barlaeus.nl>
  - add postfix-2.2.1-smtpd_sasl_authenticated_header.patch by "Branko F. Gračnar" <bfg@noviforum.si>
  - add another patch by Zoltán Mezei's <mezei.zoltan@telefor.hu>

* Sat Jan 14 2006 Simon J Mudd <sjmudd@pobox.com> 2.2.8-3
  - change mysql_paths documentation and checking to avoid misuse

* Sat Jan 07 2006 Simon J Mudd <sjmudd@pobox.com> 2.2.8-2
  - update VDA patch to 2.2.8

* Thu Jan 05 2006 Simon J Mudd <sjmudd@pobox.com> 2.2.8-1
  - update to postfix 2.2.8

* Sat Dec 11 2005 Simon J Mudd <sjmudd@pobox.com> 2.2.7-1
  - update to postfix 2.2.7

* Thu Dec 01 2005 Simon J Mudd <sjmudd@pobox.com> 2.2.6-1
  - update to postfix 2.2.6

* Thu Jul 29 2005 Simon J Mudd <sjmudd@pobox.com> 2.2.5-2
  - fix the %doc section to avoid warnings about duplicate files
  - update V_vda to 2.2.5
  - fix postfix-get-distribution to work correctly with latest whitebox-release
    - confirmed by Jeroen <jeroen@zone4.nl>

* Thu Jul 21 2005 Simon J Mudd <sjmudd@pobox.com> 2.2.5-1
  - update to postfix 2.2.5

* Wed Jun 29 2005 Simon J Mudd <sjmudd@pobox.com> 2.2.4-2
  - update VDA patch
  - update postfix-chroot.sh to work with FC4

* Mon Jun 27 2005 Simon J Mudd <sjmudd@pobox.com> 2.2.4-1
  - update to postfix 2.2.4
  - also add some code to try and detect installing a new rpm
    over a previous manually installed Postfix installation.
    (Try and avoid overwriting configuration.)

* Wed May 11 2005 Simon J Mudd <sjmudd@pobox.com> 2.2.3-2
  - update VDA patch to 2.2.3

* Sun May 08 2005 Simon J Mudd <sjmudd@pobox.com> 2.2.3-1
  - update Postfix to 2.2.3

* Sun Apr 24 2005 Simon J Mudd <sjmudd@pobox.com> 2.2.2-3
  - Postfix spf patch only works with an older version of libspf
    - adjust the Requires accordingly
    - reported by Who Knows <quien-sabe@metaorg.com>

* Fri Apr 22 2005 Simon J Mudd <sjmudd@pobox.com> 2.2.2-2
  - update SPF patch for 2.2 thanks to Eric Hoeve <ehoeve@tds.net>

* Thu Apr 07 2005 Simon J Mudd <sjmudd@pobox.com> 2.2.2-1
  - update to 2.2.2 and update VDA patch

* Wed Mar 16 2005 Simon J Mudd <sjmudd@pobox.com> 2.2.1-2
  - minor change to postfix-get-distribution to support tao-linux 1.0
    (another RHEL3 clone)
    - with help from <lars@levonline.com>

* Wed Mar 16 2005 Simon J Mudd <sjmudd@pobox.com> 2.2.1-1
  - upgrade to 2.2.1

* Mon Mar 14 2005 Simon J Mudd <sjmudd@pobox.com> 2.2.0-1
  - upgrade to 2.2.0
    - VDA patch does not apply cleanly

* Mon Feb 07 2005 Simon J Mudd <sjmudd@pobox.com> 2.2-20050206-1
  - upgrade to 2.2
    - remove support for POSTFIX_MYSQL_QUERY patch
  - make changes to use new TLS and IPv6 functionality from standard package.

* Wed Jan 07 2005 Simon J Mudd <sjmudd@pobox.com> 2.1.5-5
  - make alternatives priority configurable. It was 30 and fixed. It seems
    this can cause problems with users who want to use a different value.
    suggested by Michael Best <mbest@pendragon.org>

* Wed Dec 08 2004 Simon J Mudd <sjmudd@pobox.com> 2.1.5-4
  - minor change including TLSFIX=2 for RHEL3
    suggested by ML <ops@klez.it>

* Wed Sep 22 2004 Simon J Mudd <sjmudd@pobox.com> 2.1.5-3
  - update ipv6 patch

* Sun Sep 19 2004 Simon J Mudd <sjmudd@pobox.com> 2.1.5-2
  - Henrik Schack Jensen <henrik@schack.dk> reported that the libspf patch
    was not being applied even with POSTFIX_SPF=1. Fixed.

* Fri Sep 17 2004 Simon J Mudd <sjmudd@pobox.com> 2.1.5-1
  - add support for libspf (enabled by setting POSTFIX_SPF=1)
    - suggested by Henrik Schack Jensen <henrik@schack.dk>
  - update to 2.1.5

* Mon Sep 06 2004 Simon J Mudd <sjmudd@pobox.com> 2.1.4-6
  - make changes to avoid conflichts between authsasld and file in
    cyrus-sasld on RHEL3. Problem noted by
    Patrick Nelson <pnelson@neatech.com>

* Tue Aug 24 2004 Simon J Mudd <sjmudd@pobox.com> 2.1.4-5
  - add make-postfix.rpm which will build a new rpm, optionally using the
    installed RPM's postfix.spec.cf file, thus making RPM upgrades easier.

* Wed Jul 28 2004 Simon J Mudd <sjmudd@pobox.com> 2.1.4-4
  - rename qshape.pl to qshape to reflect the name used in the man page
    and QSHAPE_README file
  - define %mps macro directly in spec file
  - remove support for RH 6.x (macros requires_init_d & include_db)
  - fix in queue_directory_remove by Alain NAKACHE <anakache@alinto.net>

* Sun Jul 18 2004 Simon J Mudd <sjmudd@pobox.com> 2.1.4-3
  - update V_ipv6 version to 1.25-pf-2.1.4

* Sun Jul 18 2004 Simon J Mudd <sjmudd@pobox.com> 2.1.4-2
  - cleanup macro names
    - with_xxx to enable functionality
    - V_xxx    to declare the version information
  - update V_vda to 2.1.3

* Sat Jul 17 2004 Simon J Mudd <sjmudd@pobox.com> 2.1.4-1
  - update to 2.1.4

* Thu Jul 08 2004 Simon J Mudd <sjmudd@pobox.com> 2.1.3-4
  - add man pages for qshape, smtp-sink and smtp-source
  - move qshape.pl to %{_sbindir}

* Thu Jul 08 2004 Simon J Mudd <sjmudd@pobox.com> 2.1.3-3
  - add qshape.pl now included in tar ball.
  - update IPV6+TLS patch

* Mon Jun 21 2004 Simon J Mudd <sjmudd@pobox.com> 2.1.3-2
  - update TLS patch, reported by Steve Crook <steve@bananasplit.info>

* Fri Jun 18 2004 Simon J Mudd <sjmudd@pobox.com> 2.1.3-1
  - update to 2.1.3, but TLS patch does not work

* Mon Jun 14 2004 Simon J Mudd <sjmudd@pobox.com> 2.1.1-6
- patches for typo and add support for CentOS
  - thanks to Alain NAKACHE <alain@cal.fr>

* Thu Jun 08 2004 Simon J Mudd <sjmudd@pobox.com> 2.1.1-5
- added missing examples directory and a symbolic link to it from /etc/postfix
  - problem noted by Xavier Le Vourch <xavier@brittanysoftware.com>

* Mon May 31 2004 Simon J Mudd <sjmudd@pobox.com> 2.1.1-4
- fix make-postfix.spec to recognise both Fedoras: fc1 and fc2
  - thanks to help from Fred Grayson <fred@fred-grayson.net>

* Thu May 20 2004 Simon J Mudd <sjmudd@pobox.com> 2.1.1-3
- postfix-get-distribution did not correctly recognise redhat-release-3ES-7.2
  - reported by Devrim GUNDUZ <devrim@gunduz.org>
                Henrik Schack Jensen <schack@tdconline.dk>

* Mon May 10 2004 Simon J Mudd <sjmudd@pobox.com> 2.1.1-2
- remove postgres _patches_ as they are now included in 2.1.x
  - advised by Andrew Koros <akoros@ke.uu.net>

* Tue May  5 2004 Simon J Mudd <sjmudd@pobox.com> 2.1.1-1
- update to 2.1.1

* Sat May  1 2004 Simon J Mudd <sjmudd@pobox.com> 2.1.0-1
- update VDA patch, pointer from Viragh Janos <viragh@inf.u-szeged.hu>
- update IPV6 patch

* Tue Apr 27 2004 Simon J Mudd <sjmudd@pobox.com> 2.1.0-0.2
- update TLS patches
- add README-Postfix-SASL-RedHat.txt Source line

* Tue Apr 27 2004 Simon J Mudd <sjmudd@pobox.com> 2.1.0-0.1
- update to 2.1.0

* Mon Apr 19 2004 Simon J Mudd <sjmudd@pobox.com> 2.1-RC4-20040418-0.2
- thanks to Tom Diehl and others diagnose problem with a comment with
  %%install (but one percentage sign) giving all sorts of problems
- SASL readme file not found.

* Mon Apr 19 2004 Simon J Mudd <sjmudd@pobox.com> 2.1-RC4-20040418-0.1
- suffix is wrong (so revert back)
- update to RC4

* Sun Apr 18 2004 Simon J Mudd <sjmudd@pobox.com> 2.1-RC3.20040414-0.6
- revoke %if %sasl <= 1 check to using a shell if, on rh9 it fails

* Sun Apr 18 2004 Simon J Mudd <sjmudd@pobox.com> 2.1-RC3.20040414-0.5
- put documentation in %{_docdir}/%{name}-{ver}-documentation as can
  not use %{name}-%{version} as rpm's %file parsing removes this.

* Sat Apr 17 2004 Simon J Mudd <sjmudd@pobox.com> 2.1-RC3.20040414-0.3
- update to RC3
- tidy up some more with documentation

* Wed Apr 14 2004 Simon J Mudd <sjmudd@pobox.com> 2.1-RC2.20040413-0.1
- update to RC2
  - add html_dir

* Thu Apr 01 2004 Simon J Mudd <sjmudd@pobox.com> 2.1-RC1.20040331-0.1
- prepare for release candidate 1 of 2.1
- change my README files leaving one in the config directory
- move the documentation files back to %{docdir} but
  maintain symlinks from /etc/postfix for convenience.
- update postfinger to 1.29
- update SASL information borrowing the stuff from the RedHat RPM
- update ipv6 patch
- update tls patch

* Mon Mar 15 2004 Simon J Mudd <sjmudd@pobox.com> 2.0.19-1
- recognise rhel-3.0WS and also show the full distribution the rpm was built
  on. This allows us to distinguish a build on Whitebox and RedHat Enterprise
  Linux.  Problem noted by Tom Diehl <tdiehl@rogueind.com>

* Sun Feb 01 2004 Simon J Mudd <sjmudd@pobox.com> 2.0.18-20040122-0.2
- update to 2.0.18-20040122
- update patches (TLS, IPv6, VDA)
- tidyup macro names:
	vdaver		vda_version
	pfixtls		tls_version
	pgver		pg_version
	pfixipv6	ipv6_version
	cdbver		cdb_version
- incorporate some of the differences in 2.0.18 (2.0)

* Thu Nov 20 2003 Simon J Mudd <sjmudd@pobox.com> 2.0.16-20031113-0.2
  - add /usr/bin/cc as requirement

* Fri Nov 14 2003 Simon J Mudd <sjmudd@pobox.com> 2.0.16-20031113-0.1
  - update to latest snapshot
  - add anvil daemon
  - add missing documentation files

* Thu Sep 11 2003 Simon J Mudd <sjmudd@pobox.com> 2.0.14-20030812-2
  - various updates:
    - support for sasl/pcre libraries on Mandrake

* Fri Aug 29 2003 Simon J Mudd <sjmudd@pobox.com> 2.0.14-20030812-1
  - update with help from Rob Hutton <rob.hutton@comcast.net>

* Tue Aug 26 2003 Simon J Mudd <sjmudd@pobox.com> 2.0.9-20030424-1.100
  - update to sync with 2.0.14-1, doing little more than removing chroot
    functionality, replacing with postfix-chroot.sh

* Sun Jul 13 2003 Simon J Mudd <sjmudd@pobox.com> 2.0.9-20030424-1.99
  - general tidyup compared to 2.0.13-3.1, ready to update again.

* Tue May 06 2003 Simon J Mudd <sjmudd@pobox.com> 2.0.9-20030424-1
  - update to latest snapshot

* Fri Feb 20 2003 Simon J Mudd <sjmudd@pobox.com> 2.0.4-20030219-1
  - update to latest snapshot

* Mon Feb 17 2003 Simon J Mudd <sjmudd@pobox.com> 2.0.3-20030126-2
  - update to latest snapshot
  - update TLS patches
  - update IPv6 patches
  - update postfix-new-RPM-packages -> postfix-RPM-new-packages
  - add postfix-RPM-TODO
  - don't allow rpm to build using a spec file built for another distribution

* Thu Jan 16 2003 Simon J Mudd <sjmudd@pobox.com> 2.0.2-20030115-1
  - update URLs in rpm -qi postfix output
  - update postfix-new-RPM-packages
  - update to 2.0.2-20030115
  - remove postfix-makedefs.patch (to not force pcre installaton)
  - update VDA patch
  - update TLS patches
  - update CDB patches

* Thu Jan 09 2003 Simon J Mudd <sjmudd@pobox.com> 2.0.0-20030109-0.1
  - update to 2.0.0-20030109-0.1

* Wed Jan 08 2003 Simon J Mudd <sjmudd@pobox.com> 2.0.0-20030107-1.1
  - update ipv6 patch to tls+ipv6-1.10-pf-2.0.0-20030101.patch.gz

* Wed Jan 08 2003 Simon J Mudd <sjmudd@pobox.com> 2.0.0-20030107-1
  - fix master.cf: virtual should not be chrooted
    - problem reported by Alex Kramarov <alex@incredimail.com>
  - update to 2.0.0-20030107
  - restore postfix-files.patch as Wietse has now included
    ADDRESS_VERIFICATION_README (was SENDER_VERFICATION_README)
  - cosmestic: lowercase some macro names
    - SMTPD_MULTILINE_GREETING -> smtpd_multiline_greeting
    - REQUIRES_INIT_D -> requires_init_d
  - include new proxymap binary

* Tue Dec 31 2002 Simon J Mudd <sjmudd@pobox.com> 2.0.0-20021223-1
  - update to latest snapshot
  - add IPv6 support (ported from POSTFIX_2 branch), and update patche to
    tls+ipv6-1.10-pf-2.0.0-20021223
  - add missing verify daemon
  - add RELEASE_NOTES for 1.1 and 2.0 for reference
  - modify postfix-files.patch to include SENDER_VERIFICATION_README
  - Note: TLS patches unavailable for this snapshot

* Fri Dec 20 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.12-20021219-1
  - update to latest snapshot
  - update TLS patches

* Thu Dec 19 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.12-20021218-1
  - update to latest snapshot

* Sun Dec 15 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.12-20021214-1
  - rename macro: DISABLE_CHROOT -> disable_chroot
  - remove (duplicate) LICENSE from %doc directory
  - remove RELEASE_NOTES from %doc directory, it is now installed in
    the %readme_dir ( /etc/postfix/README_FILES )
  - update to latest snapshot
  - update TLS patches to 0.8.12-1.1.12-20021214-0.9.6h

* Tue Dec 10 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.12-20021209-1
  - update to 1.1.12-20021209
  - remove postfix-config.patch, not sure when it was added.
  - patch makedefs to ensure that pcre support is NOT automatically
    included unless explicitly requested
  - update glibc chroot creation
  
* Mon Dec 09 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.12-20021202-1
  - update TLS patches
  - tidy up postfix queue removal on package deletion
  - fix chroot_remove - it was not removing all chroot files
  - /usr/lib/sendmail -> /usr/sbin/sendmail check needed fixing in light of
    Postfix and sendmail existing on the machine at the same time.
    - Move it's invocation which should have been in %post, not in %preun

* Mon Dec 02 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.12-20021202-1
  - update to latest snapshot

* Mon Dec 02 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.12-20021124-2
  - remove pflogsum, now a seperate package

* Tue Nov 26 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.12-20021124-1
  - add missing hold queue
  - remove unneeded RBL patch, now included in the standard sources
  - fix cyrus-sasl-devel which in mandrake is libsasl-devel
    fix log file location for pflogsumm.pl for Mandrake
    - Jim Lohiser <jim@imaginenet.net> pointed out the problem
  - make-postfix.spec: if POSTFIX_DB=0 (and is not default) don't add stupid
    .db0 suffix.
  - Add AutoReq: no to avoid perl Date::Calc dependencies
  - update to 1.1.12-20021124-1
  - rename multiline-greeting patch, and add URL to its location

* Fri Nov 22 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.11-20021115-1
  - first build for a while on a snapshot.

* Fri Nov 22 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.11-13
  - modify make-postfix.spec and postfix.spec.in to work correctly with RH 8
    and the new db4 files.
    - Thanks to  Josep M. <websurfer_email@yahoo.es> for lending me a rh8
      machine to test this on.
  - modify postfix-get-distribution to recognise Yellowdog Linux
    - thanks to Emmanuel Seyman <seyman@acticiel.com> for testing

* Mon Oct 28 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.11-12
  - The man page links when using /usr/sbin/alternatives didn't correctly
    link the sendmail.postfix man page to the sendmail man page.
    Consequently man sendmail/newaliases/mailq would fail.  This does not
    affect users of rh before 7.3 where /usr/sbin/alternatives does not exist.

* Mon Oct 28 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.11-11
  - add support for Constant Database, CDB, by Michael Tokarev
    <mjt@corpit.ru>, as originally devised by djb.

* Mon Oct 21 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.11-10
  - add Victor Duchovni's log_recipient patch

* Sat Oct 19 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.11-9
  - 1.1.11-8 was released with an error. (multiline patch was wrong)
    This releases fixes the problem.

* Fri Oct 18 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.11-8
  - add optional RBL_MAP patch from Lamont Jones <lamont@hp.com>,
    applied with POSTFIX_RBL_MAPS=1 when used with make-postfix.spec
  - convert src/smtpd/smtpd_chat.c provided by Wietse from the
    1.2-snapshots into a diff, applying the patch at his request
  - modify multiline_banner patch to work with new smtpd_chat.c

* Mon Jul 15 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.11-7
  - update the TLS patches
  - update the VDA patches

* Mon Jul 15 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.11-6
  - add MANPAGE_SUFFIX in make-postfix.spec and %{mps} in spec file
    to allow Mandrake 8's .bz2 man page suffix to be used.
    - Erin Schnabel <erin@haaser.com>
  - add BuildRequires: rpm >= 4 to ensure that the spec file is used correctly.
    RH6.1 builds failed due to rpm v3 not processing the %if macros correctly.

* Fri Jul 12 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.11-5
  - remove debugging which was enabled when it shouldn't have been
    - reported by "Weisz, Norbert" <norbert.weisz@hp.com>
  - add Postfix user to mail group, so that it can be used more easily
    with cyrus.
    - suggestion by Christopher D. Audley <Christopher.D.Audley@jhu.edu>

* Mon Jul 08 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.11-4
  - fix typo in use of alternatives (missing backslashes)
    - reported by David Elliot <daveelliot@yahoo.com>

* Sat Jul 06 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.11-3
  - add Provides: %{_bindir}/newaliases to satisfy mailman
    - reported by Tom Diehl <tdiehl@rogueind.com>

* Fri Jul 05 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.11-2
  - Add support for alternatives (needed on RH 7.3)
    - based on patch provided by Christopher D. Audley
      <Christopher.D.Audley@jhu.edu>.
    - works on 7.3 and earlier distributions, simulating the alternatives
      package if it is not present.
    - other minor fixes based on suggestions from various testers:
      - Scott A. Hughes <sahughes@sanguine.net> 
      - Tom Diehl <tdiehl@rogueind.com>
      - Emmanuel Seyman <seyman@acticiel.com>
      - Norbert Weisz <norbert.weisz@hp.com> 

* Sun Jun 09 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.11-1
  - update to postfix-1.1.11
  - support for building with db3 on rh6.x - patch provided by
     Frederic Hermann <Frederic.Hermann@ferma.fr>
  - remove FQDN hostname checks - request by Wietse

* Sun May 19 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.10-1
  - fix debug macro bug, reported by  Christopher Audley <Christopher.D.Audley@jhu.edu>  
  - upgrade to 1.1.10
  - upgrade TLS patch

* Tue Apr 30 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.7-6
  - /lib/lidbdb.so is not needed within the chroot (it's used only by the 
    db[34]-devel packages).  So remove it.  Symptom: error message
    "cp: cannot stat `/lib/libdb.so" on machines which didn't have
    db[34]-devel installed.
    - Reported by Bill Landry <BillL@Pointshare.com>

* Sun Apr 28 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.7-5
  - various changes suggested by Todd <Freedom_Lover@bigfoot.com>
    - minor change to redhatmysql support, removing unneeded
    Requires:
    - minor change to TLS support, moving documentation to
    /usr/share/doc/postfix-1.1.7/TLS/
    - inclusion of Postfix examples directory which was missing
  - chroot environment changes: after removing chroot-setup-LINUX2 and
    replacing it with triggerin scripts some files were missing.  Fixed

* Thu Apr 18 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.7-4
  - bugfix: add Source2: postfix-get-distribution
    - advised by "Weisz, Norbert" <Norbert.Weisz@Compaq.com>

* Thu Apr 18 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.7-3
  - changes to names and stuff in spec file (basic tidy-up)
  - add qmqp-source
  - changes to use triggerin macros instead of chroot stuff
    - mainly taken from Bero and Tuomo's Postfix spec files
  - remove changelog entries for before 01-01-2002, they can still be recovered
    from my CVS archives.
  - useradd/groupadd of postfix/postdrop have been modified to not specify
    a specific user/group id.  rpm uses the name when checking permissions and
    postfix's main.cf also works with names so don't insist on specific ids.
    the uid/gids created are system accounts.
  - upgrade VDA patch to 1.1.6

* Wed Apr 10 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.7-2
  - bug fix to copy_cmd macro which was causing lots of grief

* Mon Apr 01 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.7-1
  - update to 1.1.7

* Mon Apr 01 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.6-1
  - upgrade to 1.1.6
  - minor changes to 1postfix
  - remove smtp-helo-name patch
  - update TLS patches

* Wed Mar 20 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.5-3
  - include Wietse's smtp-helo-name patch

* Wed Mar 13 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.5-2
  - upgrade TLS patches to 0.8.5

* Tue Mar 12 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.5-1
  - upgrade to postfix-1.1.5

* Tue Mar 12 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.4-4
  2 patches provided by Robert L Mathews <rob@tigertech.com> 
  - add support via POSTFIX_DISABLE_CHROOT=1 to disable standard chroot
    setup in package.
  - add support for explicitly defining the postfix uid/gid in spec file
    via POSTFIX_UID=... and POSTFIX_GID=...

* Fri Mar 08 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.4-3
  - add patch to BuildRequires!
  - add separate Postgres support patches into two parts
    - standard Postgres patches from Mathieu Arnold <arn_mat@club-internet.fr>
    - other experimental patch by George Barbarosie <georgeb@intelinet.ro>

* Fri Mar 01 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.4-2
  - add Postgres Database support: George Barbarosie <georgeb@intelinet.ro>
  - update TLS patches: Dominik Mierzejewski <dominik@aaf16.warszawa.sdi.tpnet.pl>
  - update /etc/cron.daily/1postfix script: Dominik/Simon

* Mon Feb 25 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.4-1
  - add virtual delivery agent patch, from http://www.oav.net/~kiwi/postfix
    - requested by  D M <dcm_scorpio@hotmail.com> 
  - upgrade to pflogsumm.pl 1.0.4
  - upgrade to postfix-1.1.4
  - minor modification to postfix-etc-init.d-postfix so it works correctly
    with condrestart

* Wed Feb 20 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.3-2
  - after looking at Bero's version of my rpm make some mainly cosmetic
    changes

* Sun Feb 03 2002 Simon J Mudd <sjmudd@pobox.com>
- postfix-1.1.3-1
  - update to postfix-1.1.3

* Fri Jan 25 2002 Simon J Mudd <sjmudd@pobox.com>
- postfix-1.1.2-1
  - update to postfix-1.1.2

- postfix-1.1.1-1
  - update TLS patch - pfixtls-0.8.1-1.1.1-0.9.6c

* Tue Jan 22 2002 Simon J Mudd <sjmudd@pobox.com>
- postfix-1.1.1-1
  - update to postfix-1.1.1
  - update TLS patch - pfixtls-0.8.0-1.1.0-0.9.6c

* Mon Jan 21 2002 Simon J Mudd <sjmudd@pobox.com>
- postfix-1.1.0-3, check for /usr/lib/sendmail and if it is a file NOT
    owned by another package: replace it with a symbolic link to
    /usr/sbin/sendmail [requested by Wietse to avoid upgrade problems]
  - add patch to postqueue provided by LaMont Jones <lamont@security.hp.com>
  - update TLS patch - pfixtls-0.7.16-1.1.0-0.9.6c

* Sat Jan 19 2002 Simon J Mudd <sjmudd@pobox.com>
- postfix-1.1.0-2, add serial tag, so that this version appears newer
  to RPM than version previous 200xmmdd versions.
  - thanks to Dominik Mierzejewski <dominik@aaf16.warszawa.sdi.tpnet.pl>
    for pointing this out to me.

* Sat Jan 19 2002 Simon J Mudd <sjmudd@pobox.com>
- postfix-1.1.0, update to the latest official release
  - tidying up of the spec file to fit in line with Wietse's new
    naming convention.

* Wed Jan 16 2002 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20020115-1, update to latest snapshot
  - fix postfix-files to reflect compressed man pages

* Tue Jan 15 2002 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20020113-1, update to latest snapshot
  - sample files have moved, they are now (temporarily?) in /etc/postfix
    following Wietse's wish.

* Fri Jan 11 2002 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20020111-1, update to latest snapshot

* Fri Jan 11 2002 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20020110-1, update to latest snapshot
  - update install procedures
    - use patch provided by Victor Duchovni to ensure the installation works
      as expected.

* Wed Jan 09 2002 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20020107-1, update to latest snapshot
  (candidate for next official postfix release)

* Wed Jan 01 2002 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20011226-1, update to latest snapshot

# end of postfix.spec.in
##############################################################################
