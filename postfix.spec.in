# $Id: postfix.spec.in,v 2.194.2.26 2002/04/09 15:14:34 sjmudd Exp $
#
# File used to generate the distribution-specific postfix.spec file.
# Please send bugfixes and comments to the packager.
#
# This spec file was built on distribution: __DISTRIBUTION__
#
# If you need to make changes to postfix.spec, make them to postfix.spec.in
# and regenerate the spec file.
#
# See make-postfix.spec and postfix-build in %{_sourcedir} for more information.
#
# Information imported from postfix.spec.in
#
# LDAP                     - include LDAP support
# MYSQL	                   - include www.mysql.com's MySQL rpms
# REDHATMYSQL              - include RedHat's MySQL rpms
# PCRE                     - include pcre support
# PGSQL                    - include Postgres database support
# PGSQL2                   - experimental postgres patches by George Barbarosie
#                            <georgeb@intelinet.ro>: needs PGSQL=1
# SASL                     - include SASL/AUTH support
# TLS                      - include TLS support
# TLSFIX                   - include TLS fix (apparently needed for rh6.2)
# REQUIRES_INIT_D          - Required by RedHat 7.x
# REQUIRES_DB3             - used on RH 7.x and Mandrake 8.1
# REQUIRES_DB4             - adding support for db4 (can be used on 7.2?)
# SMTPD_MULTILINE_GREETING - my patch to allow multiline banner
# POSTFIX_UID              - uid of postfix user
# POSTFIX_GID              - gid of postfix group
# POSTDROP_GID             - gid of postdrop group
# VDA                      - add virtual delivery agent patch
# DISABLE_CHROOT           - disable setup of chroot environment
#
%define distribution __DISTRIBUTION__
%define LDAP __LDAP__
%define MYSQL __MYSQL__
%define REDHATMYSQL __REDHAT_MYSQL__
%define PCRE __PCRE__
%define PGSQL __PGSQL__
%define PGSQL2 __PGSQL2__
%define SASL __SASL__
%define TLS __TLS__
%define TLSFIX __TLSFIX__
%define REQUIRES_DB3 __REQUIRES_DB3__
%define REQUIRES_DB4 __REQUIRES_DB4__
%define REQUIRES_INIT_D __REQUIRES_INIT_D__
%define SMTPD_MULTILINE_GREETING __SMTPD_MULTILINE_GREETING__
%define POSTFIX_UID __POSTFIX_UID__
%define POSTFIX_GID __POSTFIX_GID__
%define POSTDROP_GID __POSTDROP_GID__
%define VDA __VDA__
%define DISABLE_CHROOT __DISABLE_CHROOT__

# Version information
%define pflogno -1.0.4
%define vdaver 1.1.3
%define pfixtls pfixtls-0.8.7-1.1.7-0.9.6c
%define pgver 1.1.4

# If set to 1 if official version, 0 if snapshot
%define official 1 
%define ver 1.1.7
%define mail_release_date 20020115
%define rel 2
%if %{official}
%define tarball_version %{ver}
%define package_version %{ver}
%define ftp_dir official
%else
%define tarball_version %{ver}-%{mail_release_date}
%define package_version %{ver}.%{mail_release_date}
%define ftp_dir experimental
%endif

# Postfix requires one exlusive uid/gid and a 2nd exclusive gid.
%define postfix_uid    %{POSTFIX_UID}
%define postfix_gid    %{POSTFIX_GID}
%define maildrop_gid   %{POSTDROP_GID}

%define config_dir %{_sysconfdir}/postfix
%define daemon_dir %{_libexecdir}/postfix
%define queue_dir %{_var}/spool/postfix

%define newaliases_path %{_bindir}/newaliases
%define mailq_path %{_bindir}/mailq
%define rmail_path %{_bindir}/rmail
%define sendmail_path %{_sbindir}/sendmail

%define init_directory /etc/rc.d/init.d
%define cron_directory /etc/cron.daily

%define whinge /usr/bin/logger -p mail.info -t postfix/rpm
%define postfix_running %{daemon_dir}/master -t >/dev/null 2>&1; echo $?
%define die_cmd die(){ %whinge "$*"; exit 1; }

# link source file to destination directory if possible
# if the link is a symbolic link, make a copy in the destination directory
# otherwise copy the file
%define copy_cmd copy() { file=`basename $1`; ln -f $1 $2/$file 2>/dev/null || { test -L $1 2>/dev/null && { dest=`ls -l $1| awk '{print $11}'`; ln -sf $dest $2/$file; } || cp -dpf $1 $2/$file; } }

Name: postfix
Group: System Environment/Daemons
URL: http://www.postfix.org
License: IBM Public License
PreReq: /sbin/chkconfig
%if %{REQUIRES_INIT_D}
PreReq: /etc/init.d, /sbin/service
%endif
Epoch: 2
Provides: MTA smtpd smtpdaemon
Obsoletes: sendmail, exim, qmail, smail
Version: %{package_version}
Release: %{rel}__SUFFIX__
Packager: Simon J Mudd <sjmudd@pobox.com>
Summary: Postfix Mail Transport Agent
Vendor: Built on %{distribution}
Source0: ftp://ftp.porcupine.org/mirrors/postfix-release/%{ftp_dir}/postfix-%{tarball_version}.tar.gz
Source1: postfix-new-RPM-packages
Source3: postfix-etc-init.d-postfix
Source4: postfix-etc-cron.daily-postfix
Source5: postfix-aliases
Source6: postfix-chroot-setup.awk
Source7: postfix.spec.in
Source8: make-postfix.spec
Source9: ftp://ftp.aet.tu-cottbus.de/pub/postfix_tls/%{pfixtls}.tar.gz
Source10: http://jimsun.linxnet.com/downloads/pflogsumm%{pflogno}.pl
Source11: postfix-build

# Obligatory Patches
Patch1: postfix-config.patch
Patch2: postfix-smtp_sasl_proto.c.patch

# Optional patches
Patch4: postfix-%{vdaver}_quota.patch 
Patch50: http://www.mat.cc/postfix/postfix-pg.postfix-%{pgver}.patch
Patch51: postfix-pg-raw.patch
Patch99: postfix-smtpd_multiline_greeting.patch

BuildRoot: %{_tmppath}/postfix-%{package_version}-buildroot

# Determine packaging requirements
Requires: gawk, perl, sed, ed
BuildRequires: gawk, perl, sed, ed, patch

%if %{REQUIRES_DB3}
Requires: db3
BuildRequires: db3-devel
%endif

%if %{REQUIRES_DB4}
Requires: db4
BuildRequires: db4-devel
%endif

%if %{LDAP}
Requires: openldap >= 1.2.9
BuildRequires: openldap-devel >= 1.2.9
%endif

%if %{PCRE}
Requires: pcre
BuildRequires: pcre, pcre-devel
%endif

%if %{REDHATMYSQL}
Requires: mysql, mysqlclient9
BuildRequires: mysql, mysqlclient9, mysql-devel
%endif

%if %{MYSQL}
Requires: MySQL-shared, zlib
BuildRequires: MySQL-shared, MySQL-devel, zlib-devel
%endif

%if %{PGSQL}
Requires: postgresql, libpq.so
BuildRequires: postgresql, libpq.so, postgresql-devel
%endif

%if %{SASL}
Requires: cyrus-sasl
BuildRequires: cyrus-sasl, cyrus-sasl-devel
%endif

%if %{TLS}
Requires: openssl
BuildRequires: openssl-devel
%endif

%description
Postfix is a Mail Transport Agent (MTA), intended to be an alternative
to the widely-used sendmail.  This package includes optional support for
LDAP, pcre, mysql, SMTP AUTH (SASL) and TLS; by default it sets up
chroot for added security.

See http://www.redhat.com/support/docs/faqs/RH-postfix-FAQ/book1.html,
a slightly outdated FAQ, which covers the steps involved in installing
and configuring postfix.

The binary and source rpms I produce are currently available at
	http://pobox.com/~sjmudd/postfix, ftp://ftp.WL0.org
and the following mirrors:
	ftp://ftp.everdigital.org, ftp://ftp.shuttleamerica.com

This package/specfile was built from postfix.spec.in $Revision: 2.194.2.26 $,
with the following options:

SMTPD_MULTILINE_GREETING=%{SMTPD_MULTILINE_GREETING},VDA=%{VDA},PGSQL=%{PGSQL}, PGSQL2=%{PGSQL2}, DISABLE_CHROOT=%{DISABLE_CHROOT}
LDAP=%{LDAP}, SASL=%{SASL}, PCRE=%{PCRE}, TLS=%{TLS}, TLSFIX=%{TLSFIX}, MYSQL=%{MYSQL}, REDHATMYSQL=%{REDHATMYSQL}
REQUIRES_DB3=%{REQUIRES_DB3}, REQUIRES_DB4=%{REQUIRES_DB4}, REQUIRES_INIT_D=%{REQUIRES_INIT_D}
POSTFIX_UID=%{POSTFIX_UID}, POSTFIX_GID=%{POSTFIX_GID}, POSTDROP_GID=%{POSTDROP_GID}

To use postfix with alternative options download the source package and
rebuild the binary package following the instructions in the source
package or on my web page.


%prep
umask 022

%{die_cmd}

# Warn if the distribution this spec file was made for isn't the same as
# the current distribution, using a script in the SOURCES directory.
# This will be removed and built into the spec file later.

tmpdir=`rpm --eval '%{_sourcedir}'`
distribution=`sh ${tmpdir}/postfix-get-distribution`

if [ "${distribution}" != "%{distribution}" ]; then
    cat <<ENDTEXT

			W A R N I N G
			=============

This package's spec file was built for a different distribution to the
version which you are using.  If the differences (shown below) are only
a difference in MINOR version number this should not be a problem.

Current Distribution:	${distribution}
postfix.spec built for:	%{distribution}

If not it is advisable to rebuild the postfix.spec file as indicated below:

To rebuild the spec file (and thus avoid this warning) follow the following
steps:

	cd `rpm --eval '%{_sourcedir}'`
	sh make-postfix.spec	# to rebuild the spec file
	cd `rpm --eval '%{_specdir}'`
	rpm -ba postfix.spec	# to build postfix

If this procedure doesn't allow you to produce a working package, please
adivse me so I can take appropriate steps.

ENDTEXT
	sleep 10
fi

%setup -q -n postfix-%{tarball_version} -a 9

# Apply the TLS patch, must be at first, because the changes of master.cf
%if %{TLS}
patch -p1 <%{pfixtls}/pfixtls.diff
%endif

# Apply obligatory patches
%patch1 -p1 -b .config
%patch2 -p1 -b .auth

# Apply optional patches
%if %{VDA}
%patch4 -p1 -b .vda
%endif
# Apply the PostgreSQL patches only if required
%if %{PGSQL}
%patch50 -p1 -b .pg
%endif
%if %{PGSQL2}
%patch51 -p1 -b .pgraw
%endif
%if %{SMTPD_MULTILINE_GREETING}
%patch99 -p1 -b .multiline
%endif

%if %{TLS}
# Move postfix/tls docs into TLS dir
mkdir html/TLS
mv %{pfixtls}/doc/* html/TLS
for i in ACKNOWLEDGEMENTS CHANGES INSTALL README TODO; do
  mv %{pfixtls}/$i $i.TLS
done
%endif

# setup master.cf to be chrooted
%if ! %{DISABLE_CHROOT}
mv conf/master.cf conf/master.cf-nochroot
awk -f %{_sourcedir}/postfix-chroot-setup.awk < conf/master.cf-nochroot > conf/master.cf
%endif

cp %{_sourcedir}/postfix-new-RPM-packages postfix-new-RPM-packages

%build
umask 022

CCARGS=
AUXLIBS=

%ifarch s390 s390x ppc
CCARGS="${CCARGS} -fsigned-char"
%endif

%if %{LDAP}
  CCARGS="${CCARGS} -DHAS_LDAP"
  AUXLIBS="${AUXLIBS} -L/usr/lib -lldap -llber"
%endif
%if %{PCRE}
  # -I option required for pcre 3.4 (and later?)
  CCARGS="${CCARGS} -DHAS_PCRE -I/usr/include/pcre"
  AUXLIBS="${AUXLIBS} -lpcre"
%endif
# Careful:
# - Redhat's mysql package doesn't seem to need zlib support (postfix compiles without it)
# - MySQL's (www.mysql.com) package does need zlib support to compile correctly
%if %{MYSQL}
  CCARGS="${CCARGS} -DHAS_MYSQL -I/usr/include/mysql"
  AUXLIBS="${AUXLIBS} -L/usr/lib/mysql -lmysqlclient -lz -lm"
%endif
%if %{REDHATMYSQL}
  CCARGS="${CCARGS} -DHAS_MYSQL -I/usr/include/mysql"
  AUXLIBS="${AUXLIBS} -L/usr/lib/mysql -lmysqlclient -lm"
%endif
%if %{PGSQL}
  CCARGS="${CCARGS} -DHAS_PGSQL -I/usr/include/pgsql"
  AUXLIBS="${AUXLIBS} -lpq -lcrypt"
%endif
%if %{SASL}
  CCARGS="${CCARGS} -DUSE_SASL_AUTH"
  AUXLIBS="${AUXLIBS} -lsasl"
%endif
%if %{TLS}
# See http://www.openldap.org/lists/openldap-devel/200105/msg00008.html
# - it seems rh6.2 needs LIBS=-ldl to build correctly.
# - reported by Jauder Ho <jauderho@carumba.com>
  if [ "${TLSFIX}" = 1 ]; then
    LIBS=-ldl
  else
    LIBS=
  fi
  CCARGS="${CCARGS} -DHAS_SSL -I/usr/include/openssl"
  AUXLIBS="${AUXLIBS} -lssl -lcrypto"
%endif

export CCARGS AUXLIBS
make -f Makefile.init makefiles
unset CCARGS AUXLIBS
make DEBUG="" OPT="$RPM_OPT_FLAGS"

%pre
umask 022

%{die_cmd}

# return 0 if hostname is a FQDN
check_hostname() {
    if [ "`hostname | grep -c '\.'`" = "1" ]; then
        ok=0
    else
        ok=1
    fi
    return ${ok}
}

# return 0 if myhostname is a FQDN
check_myhostname() {
    ok=1
    test -f %{config_dir}/main.cf && \
        test -x %{_sbindir}/postconf && \
        %{_sbindir}/postconf myhostname >/dev/null 2>&1 && \
        test "`%{_sbindir}/postconf myhostname | grep -c '\.'`" = "1" && \
        ok=0
    return ${ok}
}

stop_install() {
    cat <<END
ERROR: Postfix can't be installed - Please set your hostname to a FQDN.

For postfix to work correctly your hostname must be a fully-qualified domain
name or %{config_dir}/main.cf must have the myhostname parameter set
to a FQDN.

Part of the package installation requires several postfix commands to be
executed, and these will fail if these conditions are not met.

Please set the hostname to a fully-qualified hostname to enable the package
to be installed correctly.
END
    die "Error - To install the postfix rpm please set your hostname to a FQDN"
}

# The 'post' phase of installation requires use of various postfix commands:
# postalias, postcheck and postconf.  These all require that the hostname
# is a FQDN or that main.cf (if upgrading) has myhostname set to a FQDN.
# To avoid problems with the package installation failing in the %post phase
# we check the hostname and myhostname (if upgrading) and warn the user if
# the conditions are not met.
check_myhostname || check_hostname || stop_install

# create postfix user and group, and maildrop group on INSTALL machine if necessary
# Use perl here rather than looking in /etc/passwd or /etc/group as this works
# in a wider NIS environment

perl -e '$gid=getgrnam("postdrop"); exit 1 if ! defined( $gid )' || {
    perl -e '$nam=getgrgid(%{maildrop_gid}); exit 1 if defined( $nam )' || die \
            'gid collision, aborting install' \
	    'either add "postdrop" group or delete the group using GID %{maildrop_gid}'
    %whinge "Adding postdrop (gid=%{maildrop_gid}) to /etc/group."
    %{_sbindir}/groupadd -g %{maildrop_gid} -r postdrop
}

perl -e '$gid=getgrnam("postfix"); exit 1 if ! defined( $gid )' || {
    perl -e '$nam=getgrgid(%{postfix_gid}); exit 1 if defined( $nam )' || die \
            'gid collision, aborting install' \
	    'either add "postfix" group or delete the group using GID %{postfix_gid}'
    %whinge "Adding postfix (gid=%{postfix_gid}) to /etc/group."
    %{_sbindir}/groupadd -g %{postfix_gid} -r postfix
}

perl -e '$uid=getpwnam("postfix"); exit 1 if ! defined( $uid )' || {
    perl -e '$nam=getpwuid(%{postfix_uid}); exit 1 if defined( $nam )' || die \
          'uid collision, aborting install' \
          'either add "postfix" user or delete the user using UID %{postfix_uid}'
    %whinge "Adding postfix (uid=%{postfix_uid}) to /etc/passwd."
    %{_sbindir}/useradd -d %{queue_dir} -s /bin/true -g postfix -M -r -u %{postfix_uid} postfix
}

%install
umask 022

[ %{buildroot} != "/" ] && {
    /bin/rm -rf   %{buildroot}
    /bin/mkdir -p %{buildroot}
}

strip -R .comment --strip-unneeded bin/* libexec/*

# install postfix into %{buildroot}
sh postfix-install -non-interactive \
       install_root=%{buildroot} \
       config_directory=%{config_dir} \
       daemon_directory=%{daemon_dir} \
       command_directory=%{_sbindir} \
       queue_directory=%{queue_dir} \
       sendmail_path=%{sendmail_path} \
       newaliases_path=%{newaliases_path} \
       mailq_path=%{mailq_path} \
       mail_owner=postfix \
       setgid_group=postdrop \
       manpage_directory=%{_mandir} \
       sample_directory=%{config_dir}/samples \
       readme_directory=%{config_dir}/README_FILES || exit 1

# RPM compresses man pages automatically.
# - Edit postfix-files to reflect this, so post-install won't get confused
#   when called during package installation.
ed %{buildroot}%{config_dir}/postfix-files <<EOF || exit 1
%s/\(\/man[158]\/.*\.[158]\):/\1.gz:/
w
q
EOF

# Change alias_maps and alias_database default directory to %{config_dir}
bin/postconf -c %{buildroot}%{config_dir} -e \
	"alias_maps = hash:%{config_dir}/aliases" \
	"alias_database = hash:%{config_dir}/aliases" \
|| exit 1

# This installs into the /etc/rc.d/init.d directory
/bin/mkdir -p %{buildroot}%{init_directory}
install %{_sourcedir}/postfix-etc-init.d-postfix \
                  %{buildroot}%{init_directory}/postfix

# Copy the Linux chroot setup script to %{config_dir}, ready to use,
# later, removing the 'postfix reload' call from this script
%if ! %{DISABLE_CHROOT}
sed '
s;postfix reload;#postfix reload # - do not reenable - used by rpm;
' examples/chroot-setup/LINUX2 \
    > %{buildroot}%{config_dir}/chroot-setup-LINUX2
chmod 0744 %{buildroot}%{config_dir}/chroot-setup-LINUX2

# These set up the chroot directory structure
mkdir -p %{buildroot}%{queue_dir}/etc
mkdir -p %{buildroot}%{queue_dir}/lib
mkdir -p %{buildroot}%{queue_dir}/usr/lib/zoneinfo
%endif

# This is the /etc/cron.daily directory
/bin/mkdir -p %{buildroot}%{cron_directory}

# This file is named 1postfix to ensure it is run _before_ logrotate
install %{_sourcedir}/postfix-etc-cron.daily-postfix %{buildroot}%{cron_directory}/1postfix

# install pflogsumm.pl (used by daily cron) into %{_sbindir}
install -m 755 %{_sourcedir}/pflogsumm%{pflogno}.pl %{buildroot}%{_sbindir}/pflogsumm.pl

install auxiliary/rmail/rmail %{buildroot}%{rmail_path}

# copy new aliases files and generate a ghost aliases.db file
cp -f %{_sourcedir}/postfix-aliases %{buildroot}%{config_dir}/aliases
chmod 644 %{buildroot}%{config_dir}/aliases

touch %{buildroot}/%{config_dir}/aliases.db

for i in active bounce corrupt defer deferred flush incoming private saved; do
    mkdir -p %{buildroot}%{queue_dir}/$i
done
for i in maildrop public pid; do
    mkdir -p %{buildroot}%{queue_dir}/$i
done

# install smtp-sink/smtp-source by hand
for i in qmqp-source smtp-sink smtp-source; do
  install -m 755 bin/$i %{buildroot}%{_sbindir}/$i
done

# Executed after the package has been installed.
# - activate postfix, setup chroot environment if necessary
%post
umask 022

# setup the chroot environment
chroot_setup () {
  # setup chroot basic structure, but do not fail if the script fails
  %{config_dir}/chroot-setup-LINUX2 || true

  %if %{LDAP}
    # Setup ldap chroot
    %{copy_cmd}

    for i in /usr/lib/libldap*.so* /usr/lib/liblber.so*; do
      [ -e $i ] && copy $i %{queue_dir}/usr/lib
    done
  %endif
}

/sbin/chkconfig --add postfix

# upgrade configuration files if necessary
sh %{config_dir}/post-install upgrade-package \
	config_directory=%{config_dir} \
	daemon_directory=%{daemon_dir} \
	command_directory=%{_sbindir} \
	mail_owner=postfix \
	setgid_group=postdrop \
	manpage_directory=%{_mandir} \
	sample_directory=%{config_dir}/samples \
	readme_directory=%{config_dir}/README_FILES \
|| :

# build the aliases.db file on the INSTALL machine
%{_sbindir}/postalias %{config_dir}/aliases
%{_sbindir}/postfix check || :

%if ! %{DISABLE_CHROOT}
  chroot_setup
%endif

# Add submission to services if not found, required for rh <= 7.0
if ! grep -q ^submission %{_sysconfdir}/services
then
cat <<EOF >>%{_sysconfdir}/services
submission	587/tcp		msa	# mail message submission
submission	587/udp		msa	# mail message submission
EOF
fi

# Add smtps to services if not found
if ! grep -q ^smtps %{_sysconfdir}/services
then
cat <<EOF >>%{_sysconfdir}/services
smtps		465/tcp			# SMTP over SSL (TLS)
EOF
fi

%preun
umask 022

stop_postfix () {
    echo "Stopping the Postfix mail system"
    if [ -f %{queue_dir}/pid/master.pid ]; then
        kill `sed 1q %{queue_dir}/pid/master.pid` >/dev/null 2>&1 || true
    else
        echo "BUG: postfix.spec (preun) - please inform packager"
    fi
}

# remove chroot jail when uninstalling the package
# WE MUST BE IN /var/spool/postfix before calling this routine

chroot_remove () {
  %if %{LDAP}
    # remove ldap chroot environment
    /bin/rm -f %{queue_dir}/usr/lib/libldap*.so* || true
    /bin/rm -f %{queue_dir}/usr/lib/liblber.so*  || true
  %endif
    
    for i in etc/localtime usr/lib/zoneinfo/localtime \
            etc/host.conf etc/resolv.conf etc/nsswitch.conf \
	    etc/hosts etc/passwd etc/services \
	    lib/libnss_* lib/libresolv* lib/libdb*; do
        test -f $i && /bin/rm -f $i
    done

    for dir in usr/lib/zoneinfo usr/lib usr lib etc; do
        test -d $dir && /bin/rmdir $dir || \
	    echo "WARNING: preun - unable to remove directory %{queue_dir}/$dir"
    done
}

# selectively remove the rest of the queue directory structure
# first remove the "queues" (and assume the hash depth is still 2)
queue_directory_remove () {
    for dir in active bounce defer deferred flush incoming; do
        for a in 0 1 2 3 4 5 6 7 8 9 A B C D E F; do
   	    test -d $dir/$a && {
	        for b in 0 1 2 3 4 5 6 7 8 9 A B C D E F; do
		    test -d $dir/$a/$b && (
		        /bin/rm -f $dir/$a/$b/*
		        /bin/rmdir $dir/$a/$b
		    )
		done
		/bin/rmdir $dir/$a || echo "WARNING: preun - unable to remove directory %{queue_dir}/$dir/$a"
	    }
        done
	/bin/rmdir $dir || echo "WARNING: preun - unable to remove directory %{queue_dir}/$dir"
    done

    # now remove the other directories
    for dir in corrupt maildrop pid private public saved; do
        test -d $dir && {
            /bin/rm -f $dir/*
            /bin/rmdir $dir || echo "WARNING: preun - unable to remove directory %{queue_dir}/$dir"
        }
    done
}

if [ "$1" = 0 ]; then
    /sbin/service postfix stop &>/dev/null
    /sbin/chkconfig --del postfix

    # userdel also deletes the user's group
    userdel postfix   || %whinge "WARNING: failed to remove user postfix"
    groupdel postdrop || %whinge "WARNING: failed to remove group postdrop"

    cd %{queue_dir} && {
        %if ! %{DISABLE_CHROOT}
          chroot_remove
        %endif
        
        queue_directory_remove
    }
    true # to ensure we exit safely
fi

# ---
# Request by Wietse: if there is a /usr/lib/sendmail file (ie not symbolic link), not owned by
# a package then replace it with a symbolic link to /usr/sbin/sendmail.
# ---

SENDMAIL=/usr/lib/sendmail
test -f ${SENDMAIL} && {
    rpm -qf ${SENDMAIL} >/dev/null 2>&1 || ln -sf %{sendmail_path} ${SENDMAIL}
} || true

%postun
umask 022
if [ "$1" -ge 1 ]; then
    /sbin/service postfix condrestart 
fi

%clean
/bin/rm -rf %{buildroot}


%files
%defattr(-, root, root)
%verify(not md5 size mtime) %config %dir %{config_dir}
%attr(0644, root, root)         %{config_dir}/LICENSE
%attr(0755, root, root) %config %{config_dir}/postfix-script
%attr(0755, root, root) %config %{config_dir}/post-install
%attr(0644, root, root)                                                %{config_dir}/postfix-files
%attr(0644, root, root) %verify(not md5 size mtime) %config(noreplace) %{config_dir}/main.cf
%attr(0644, root, root)                                                %{config_dir}/main.cf.default
%attr(0644, root, root) %verify(not md5 size mtime) %config(noreplace) %{config_dir}/master.cf
%attr(0644, root, root) %verify(not md5 size mtime) %config(noreplace) %{config_dir}/access
%attr(0644, root, root) %verify(not md5 size mtime) %config(noreplace) %{config_dir}/aliases
%attr(0644, root, root) %verify(not md5 size mtime) %ghost             %{config_dir}/aliases.db
%attr(0644, root, root) %verify(not md5 size mtime) %config(noreplace) %{config_dir}/canonical
%attr(0644, root, root) %verify(not md5 size mtime) %config(noreplace) %{config_dir}/pcre_table
%attr(0644, root, root) %verify(not md5 size mtime) %config(noreplace) %{config_dir}/regexp_table
%attr(0644, root, root) %verify(not md5 size mtime) %config(noreplace) %{config_dir}/relocated
%attr(0644, root, root) %verify(not md5 size mtime) %config(noreplace) %{config_dir}/transport
%attr(0644, root, root) %verify(not md5 size mtime) %config(noreplace) %{config_dir}/virtual

%dir %attr(-, root, root) %{config_dir}/samples
%attr(0644,   root, root) %{config_dir}/samples/*
%dir %attr(-, root, root) %{config_dir}/README_FILES
%attr(0644,   root, root) %{config_dir}/README_FILES/*

%attr(0755, root, root) %config %{init_directory}/postfix

%dir                      %verify(not md5 size mtime) %{queue_dir}
%if ! %{DISABLE_CHROOT}
  %dir %attr(-, root, root) %verify(not md5 size mtime) %{queue_dir}/etc
  %dir %attr(-, root, root) %verify(not md5 size mtime) %{queue_dir}/lib
  %attr(-, root, root)      %verify(not md5 size mtime) %{queue_dir}/usr
%endif

# For correct directory permissions check postfix-install script
%dir %attr(0700, postfix, root)     %verify(not md5 size mtime) %{queue_dir}/active
%dir %attr(0700, postfix, root)     %verify(not md5 size mtime) %{queue_dir}/bounce
%dir %attr(0700, postfix, root)     %verify(not md5 size mtime) %{queue_dir}/corrupt
%dir %attr(0700, postfix, root)     %verify(not md5 size mtime) %{queue_dir}/defer
%dir %attr(0700, postfix, root)     %verify(not md5 size mtime) %{queue_dir}/deferred
%dir %attr(0700, postfix, root)     %verify(not md5 size mtime) %{queue_dir}/flush
%dir %attr(0700, postfix, root)     %verify(not md5 size mtime) %{queue_dir}/incoming
%dir %attr(0700, postfix, root)     %verify(not md5 size mtime) %{queue_dir}/private
%dir %attr(0700, postfix, root)     %verify(not md5 size mtime) %{queue_dir}/saved

%dir %attr(0730, postfix, postdrop) %verify(not md5 size mtime) %{queue_dir}/maildrop
%dir %attr(0710, postfix, postdrop) %verify(not md5 size mtime) %{queue_dir}/public

%dir %attr(0755, root, root)        %verify(not md5 size mtime) %{queue_dir}/pid

%attr(0755, root, root) %verify(not md5 size mtime) %config(noreplace) %{cron_directory}/1postfix

%doc 0README
%doc COMPATIBILITY
%doc HISTORY
%doc INSTALL
%doc LICENSE
%doc PORTING
%doc RELEASE_NOTES

%if %{PGSQL}
%doc PGSQL_README
%endif

%doc postfix-new-RPM-packages

%if %{TLS}
%doc ACKNOWLEDGEMENTS.TLS
%doc CHANGES.TLS
%doc README.TLS
%doc TODO.TLS
%doc html/TLS/*
%doc %{pfixtls}/contributed/make-postfix-cert.sh
%endif

%doc html

%if ! %{DISABLE_CHROOT}
%attr(0744, root, root) %config %{config_dir}/chroot-setup-LINUX2
%endif

%dir %attr(0755, root, root) %verify(not md5 size mtime) %{daemon_dir}
%{daemon_dir}/bounce
%{daemon_dir}/cleanup
%{daemon_dir}/error
%{daemon_dir}/flush
%{daemon_dir}/lmtp
%{daemon_dir}/local
%{daemon_dir}/master
%{daemon_dir}/nqmgr
%{daemon_dir}/pickup
%{daemon_dir}/pipe
%{daemon_dir}/qmgr
%{daemon_dir}/qmqpd
%{daemon_dir}/showq
%{daemon_dir}/smtp
%{daemon_dir}/smtpd
%{daemon_dir}/spawn
%{daemon_dir}/trivial-rewrite
%{daemon_dir}/virtual

%if %{TLS}
%{daemon_dir}/tlsmgr
%endif

%{_sbindir}/postalias
%{_sbindir}/postcat
%{_sbindir}/postconf
%attr(2755,root,postdrop) %{_sbindir}/postdrop
%attr(2755,root,postdrop) %{_sbindir}/postqueue
%{_sbindir}/postfix
%{_sbindir}/postkick
%{_sbindir}/postlock
%{_sbindir}/postlog
%{_sbindir}/postmap
%{_sbindir}/postsuper

%{_sbindir}/smtp-sink
%{_sbindir}/smtp-source
%{_sbindir}/qmqp-source

%attr(555,root,root) %{_sbindir}/pflogsumm.pl

%{sendmail_path}
%{mailq_path}
%{newaliases_path}
%attr(0755, root, root) %{rmail_path}

%{_mandir}/*/*

##############################################################################
# List of changes made to this package.
#
# Although old entries from the changelog have been removed most of them
# are available from my CVS repository of changes made to this file.
#

%changelog

* Tue Apr 09 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.7-2
  - changes to names and stuff in spec file (basic tidy-up)
  - add qmqp-source

* Mon Apr 01 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.7-1
  - update to 1.1.7

* Mon Apr 01 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.6-1
  - upgrade to 1.1.6
  - minor changes to 1postfix
  - remove smtp-helo-name patch
  - update TLS patches

* Wed Mar 20 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.5-3
  - include Wietse's smtp-helo-name patch

* Wed Mar 13 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.5-2
  - upgrade TLS patches to 0.8.5

* Tue Mar 12 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.5-1
  - upgrade to postfix-1.1.5

* Tue Mar 12 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.4-4
  2 patches provided by Robert L Mathews <rob@tigertech.com> 
  - add support via POSTFIX_DISABLE_CHROOT=1 to disable standard chroot
    setup in package.
  - add support for explicitly defining the postfix uid/gid in spec file
    via POSTFIX_UID=... and POSTFIX_GID=...

* Fri Mar 08 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.4-3
  - add patch to BuildRequires!
  - add separate Postgres support patches into two parts
    - standard Postgres patches from Mathieu Arnold <arn_mat@club-internet.fr>
    - other experimental patch by George Barbarosie <georgeb@intelinet.ro>

* Fri Mar 01 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.4-2
  - add Postgres Database support: George Barbarosie <georgeb@intelinet.ro>
  - update TLS patches: Dominik Mierzejewski <dominik@aaf16.warszawa.sdi.tpnet.pl>
  - update /etc/cron.daily/1postfix script: Dominik/Simon

* Mon Feb 25 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.4-1
  - add virtual delivery agent patch, from http://www.oav.net/~kiwi/postfix
    - requested by  D M <dcm_scorpio@hotmail.com> 
  - upgrade to pflogsumm.pl 1.0.4
  - upgrade to postfix-1.1.4
  - minor modification to postfix-etc-init.d-postfix so it works correctly
    with condrestart

* Wed Feb 20 2002 Simon J Mudd <sjmudd@pobox.com> 1.1.3-2
  - after looking at Bero's version of my rpm make some mainly cosmetic
    changes

* Sun Feb 03 2002 Simon J Mudd <sjmudd@pobox.com>
- postfix-1.1.3-1
  - update to postfix-1.1.3

* Fri Jan 25 2002 Simon J Mudd <sjmudd@pobox.com>
- postfix-1.1.2-1
  - update to postfix-1.1.2

- postfix-1.1.1-1
  - update TLS patch - pfixtls-0.8.1-1.1.1-0.9.6c

* Tue Jan 22 2002 Simon J Mudd <sjmudd@pobox.com>
- postfix-1.1.1-1
  - update to postfix-1.1.1
  - update TLS patch - pfixtls-0.8.0-1.1.0-0.9.6c

* Mon Jan 21 2002 Simon J Mudd <sjmudd@pobox.com>
- postfix-1.1.0-3, check for /usr/lib/sendmail and if it is a file NOT
    owned by another package: replace it with a symbolic link to
    /usr/sbin/sendmail [requested by Wietse to avoid upgrade problems]
  - add patch to postqueue provided by LaMont Jones <lamont@security.hp.com>
  - update TLS patch - pfixtls-0.7.16-1.1.0-0.9.6c

* Sat Jan 19 2002 Simon J Mudd <sjmudd@pobox.com>
- postfix-1.1.0-2, add serial tag, so that this version appears newer
  to RPM than version previous 200xmmdd versions.
  - thanks to Dominik Mierzejewski <dominik@aaf16.warszawa.sdi.tpnet.pl>
    for pointing this out to me.

* Sat Jan 19 2002 Simon J Mudd <sjmudd@pobox.com>
- postfix-1.1.0, update to the latest official release
  - tidying up of the spec file to fit in line with Wietse's new
    naming convention.

* Wed Jan 16 2002 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20020115-1, update to latest snapshot
  - fix postfix-files to reflect compressed man pages

* Tue Jan 15 2002 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20020113-1, update to latest snapshot
  - sample files have moved, they are now (temporarily?) in /etc/postfix
    following Wietse's wish.

* Fri Jan 11 2002 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20020111-1, update to latest snapshot

* Fri Jan 11 2002 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20020110-1, update to latest snapshot
  - update install procedures
    - use patch provided by Victor Duchovni to ensure the installation works
      as expected.

* Wed Jan 09 2002 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20020107-1, update to latest snapshot
  (candidate for next official postfix release)

* Wed Jan 01 2002 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20011226-1, update to latest snapshot

* Wed Dec 24 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20011217-1, update to latest snapshot

* Wed Dec 12 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20011210-2
  - update to latest TLS patch (pfixtls-0.7.13d-snap20011210-0.9.6b)

* Tue Dec 11 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20011210-1
  - update to latest snapshot

* Wed Nov 28 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20011127-2
  - add explicit test for non FQDN hostnames and abort the install, while
    giving a warning to the user if this happens.
  - update to latest TLS patch

* Wed Nov 28 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20011127-1
  - update to latest snapshot: Wietse fixes several bugs he's found

* Wed Nov 27 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20011125-1
  - update to latest snapshot

* Wed Nov 21 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20011121-1
  - update to latest snapshot

* Mon Nov 19 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20011116-1
  - update to latest snapshot

* Mon Nov 19 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20011115-2
  - update TLS patches to pfixtls-0.7.13-snap20011115-0.9.6b

* Mon Nov 16 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20011115-1
  - fixes smtpd command log memory exhaustion bug

* Mon Nov 15 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20011114-1
  - upgrade to latest snapshot

* Mon Nov 05 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20011105-2
  - add a little more support to make-postfix.spec for Mandrake Linux.

* Mon Nov 05 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20011105-1
  - update to snapshot 20011104
  - update TLS patches to pfixtls-0.7.12-snap20011104-0.9.6b
  - remove errors-to patch (incorporated into snapshot)
  - remove cleanup_map1n patch (incorporated into snapshot)
  - update to snapshot 2001105

* Sat Nov 03 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20011008-5
  - change pflogsumm.pl permissions so that it is group and world executable
  - name change and updated text: postfix-new-RPMS -> postfix-new-RPM-packages
  - changes to make-postfix.spec to ensure that we produce different package
    suffices for rh7.0 and rh7.1 than rh7.2

* Tue Oct 30 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20011008-4
  - add chroot of openldap-2 libraries
  - add Wietse's cleanup "recursive" patch

* Thu Oct 18 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20011008-3
  - update to latest TLS patch (0.7.11)
  - enable building as non-root:
    - patches provided by Dominik Mierzejewski <dmierzej@elka.pw.edu.pl>

* Wed Oct 17 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20011008-2
  - include Wietse's patch to cleanup to fix errors-to:
    header processing

* Tue Oct 09 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20011008-1
  - update to latest snapshot
  - update TLS patches
  - remove bounce notify patch (which has been incorporated)

* Sat Sep 08 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20010808-5
  - update to latest TLS patch (0.7.9)
  - cosmetic modification to /etc/cron.daily/1postfix

* Mon Sep 03 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20010808-4, include patch by Chris Audley <Christopher.D.Audley@jhu.edu>
  to allow the installation to see postfix accounts via pam and not exclusively
  through the /etc/passwd and /etc/group files.

* Fri Aug 31 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20010808-3, include Wietse's bounce notify patch

* Thu Aug 30 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20010808-2, update to latest TLS patch (0.7.8)

* Sun Aug 12 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20010808-1, update to latest snapshot

* Mon Jul 23 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20010709-3, including missing documentation files (Daniel Roesen)

* Sun Jul 08 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20010709-2, update to pfixtls-0.7.4-snap20010709-0.9.6b

* Sun Jul 08 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20010709-1, update to latest snapshot, and remove smtp_addr.c patch

* Sun Jul 08 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20010610-3, apply Wietse's smtp_addr.c.patch

* Mon Jun 11 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20010610-2, minor changes to keep in line with release spec file

* Mon Jun 11 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20010610-1, update to latest snapshot version

* Fri Jun 08 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20010525-5, changes in macro usage to try and ensure there are no
  redhat specific instructions or directories mentioned.  This should help
  portability across different rpm distributions.

* Wed May 30 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20010525-4, remove a couple of files
  - add postfix-new-RPMS
  - include -I/usr/include/pcre as required with some versions of pcre-devel

* Wed May 30 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20010525-3, update TLS patch to 0.7.3a

* Mon May 26 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20010525-2, incorporate Wietse's sasl auth patch and make
  adjustments to get it working

* Mon May 26 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20010525-1, incorporate Wietse's sasl auth patch, but don't
  enable as it doesn't seem to work
- update to snapshot 20010525

* Mon May 25 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20010502-6, update pflogsumm.pl to 1.0.3

* Mon May 07 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20010502-4, general tidyup of make-postfix.spec
  - also add check if built from source on a different version of linux to
    the one the spec file was originally created for.
  - add postfix-build to ./SOURCES directory to simplify building.

* Mon May 07 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20010502-3
  - configuration changes, used with make-postfix.spec
  - remove changelog entries before 01-01-2001
  - modifications to improve support with MySQL-3.23.36-1
  - add warning if rebuilding and haven't updated spec file from .spec.in
    in ./SOURCES

* Mon May 07 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20010502-2, add smptd_check.c.patch from Wietse

* Fri May 04 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20010502-1, change /etc/cron.daily/postfix and add support
  for pflogsumm.pl
- update TLS patch
- remove temporary smtpd.c.patch

* Fri Apr 06 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20010329-3, minor changes
  - remove TLS files from my cvs tree
  - add %{branch} macro to fall in line with release spec file
  - change rpm -qi information

* Fri Apr 06 2001 Simon J Mudd <sjmudd@pobox.com>
- snapshot-20010329-2
- disable TLS support as the given patch doesn't work
- change naming to add snapshot suffix.
	Thus this package will be
	- postfix-20010329snaphot-2

* Tue Apr 03 2001 Simon Mudd <sjmudd@pobox.com>
- update to snapshot-20010329
- remove flush, and cleanup patches

* Tue Apr 03 2001 Simon Mudd <sjmudd@pobox.com>
- adjust the TLS patch, the previous patch version I had applied was incorrect.
  (Peter Tuschy <peter@tuschy.com>)

* Fri Mar 30 2001 Simon Mudd <sjmudd@pobox.com>
- snapshot-20010228-5, add patches
	- flush.c
	- cleanup.c
- added support for TLS, information and patches to spec file
  provided by Peter Tuschy <peter@tuschy.com>.

* Sat Mar 24 2001 Simon Mudd <sjmudd@pobox.com>
- snapshot-20010228-4, add %{daemon_directory}/virtual, virtual transport
  to %files list.  Pointed out to me by Daniel Buchmann <db@bibsys.no>.

* Fri Mar 23 2001 Simon Mudd <sjmudd@pobox.com>
- snapshot-20010228-3, remove the support in the startup script for
  multilanguage descriptions.  This doesn't work on RH6 boxes.

* Tue Mar 07 2001 Simon Mudd <sjmudd@pobox.com>
- snapshot-20010228-2,  update to use postfix-filelist (in my CVS tree)
  include BuildRequires tag
  add die() to %prep, as it was missing, Ramiro Morales <rmrpms@usa.net>

* Wed Mar 01 2001 Simon Mudd <sjmudd@pobox.com>
- remove POSTFIX_SAFE_MYNETWORKS from make-postfix.spec
- snapshot-20010228-1,  update to latest snapshot
- include hashed incoming directory in chroot_remove

* Mon Feb 26 2001 Simon Mudd <sjmudd@pobox.com>
- snapshot-20010225-1,  update to latest snapshot
- remove references to POSTFIX_SAFE_MYNETWORKS optional patch as no longer
  required.

* Tue Feb 20 2001 Simon Mudd <sjmudd@pobox.com>
- snapshot-20010222-1,  update to latest snapshot
                        further minor changes to /etc/rc.d/init.d/postfix

* Tue Feb 20 2001 Simon Mudd <sjmudd@pobox.com>
- snapshot-20010204-4,  minor changes
  - fix spelling mistake in changelog, droesen's name
  - change -f check to -x in /etc/rc.d/init.d/postfix and
                             /etc/cron.daily/postfix
  - change /etc/rc.d/init.d/postfix to correctly show the [OK]
    and [FAILED] tags on startup.  I think this is correct, but the
    RedHat documentation is lacking here.

* Wed Feb 07 2001 Simon Mudd <sjmudd@pobox.com>
- snapshot-20010204-3, avoid the /var/spool/postfix/maildrop - directory
  not empty error message.

* Wed Feb 07 2001 Simon Mudd <sjmudd@pobox.com>
- snapshot-20010204-2, various changes - suggestions from Ben Cross
  - uninstall is not quite right.
  - spec file had a few rpmlint problems
  - one minor thing I can't find.  uninstalling gives a message
	/var/spool/postfix/maildrop - directory not empty - why????
	/etc/postfix not removed, but not too worried about this.

* Mon Feb 05 2001 Simon Mudd <sjmudd@pobox.com>
- snapshot-20010204-1, upgrade to latest snapshot
- fix problem when upgrading with postfix stopped
  (due to chroot-setup-LINUX2 having a call to postfix reload)

* Sun Feb 04 2001 Simon Mudd <sjmudd@pobox.com>
- snapshot-20010128-2, fix mysql build which had an error

* Mon Jan 30 2001 Simon Mudd <sjmudd@pobox.com>
- snapshot-20010128-1, update for latest snapshot

* Fri Jan 26 2001 Simon Mudd <sjmudd@pobox.com>
- snapshot-20001217-13, Mysql support was incorrect - fixed
  Ramiro Morales <rmrpms@usa.net>

* Fri Jan 26 2001 Simon Mudd <sjmudd@pobox.com>
- snapshot-20001217-12, include missing DB_README
- include support for both mysql (RedHat MySQL packages) and
  MySQL (www.mysql.com MySQL packages) as they use different
  names.  Introduction of new define REDHATMYSQL for the first
  case.  Suggestions by Ramiro Morales <rmrpms@usa.net>
- fix make-postfix.spec (missing -z checks) <ilmis@compart.fi>
- add Conflicts: for exim and qmail

* Sun Jan 21 2001 Simon Mudd <sjmudd@pobox.com>
- snapshot-20001217-11, following suggestion by Daniel Roesen
  remove newaliases when calling /etc/init.d/postfix start
- modify /etc/init.d/postfix to follow the newer rh7 style
- include fallback_relay patch (Wietse)
- update Daniel Roesen's broken auth patch

* Fri Jan 19 2001 Simon Mudd <sjmudd@pobox.com>
- snapshot-20001217-10, include LDAP chroot jail support

* Fri Jan 12 2001 Simon Mudd <sjmudd@pobox.com>
- snapshot-20001217-9, change description making it briefer and including
  URL to Bennett Todd's packages.
- Reduce dependency on postfix.spec.in, by using %if declarations

* Thu Jan 04 2001 Simon Mudd <sjmudd@pobox.com>
- snapshot-20001217-8, minor touches to build procedure

