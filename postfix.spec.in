##############################################################################
#
# $Id: postfix.spec.in,v 2.73.2.43 2001/05/27 09:42:01 sjmudd Exp $
#
# File used to generate the different spec files, used to build the postfix
# package on RedHat Linux.
#
# Please send bugfixes and comments to the packager.
#
##############################################################################
#
# This spec file generated with the following options:
#
# Built on __DISTRIBUTION__
# 
# If you need to make changes do them to the postfix.spec.in file and
# regenerate the spec file.  See
#
#	SOURCES/make-postfix.spec
#	SOURCES/postfix-build
#
# for more information.
#
##############################################################################

# defines according to our taste - values should be 0 (NO) or 1 (YES)
#
# LDAP	- include LDAP support
# PCRE	- include pcre support
# SASL	- include SASL/AUTH support
# Choose at most ONE of the following:
# MYSQL	      - include MySQL support - use www.mysql.com - MySQL* packages
# REDHATMYSQL - include MySQL support - use RedHat - mysql* packages
# TLS  - include TLS support

%define distribution __DISTRIBUTION__
%define LDAP __LDAP__
%define MYSQL __MYSQL__
%define REDHATMYSQL __REDHAT_MYSQL__
%define PCRE __PCRE__
%define SASL __SASL__
%define TLS __TLS__
%define REQUIRES_DB3 __REQUIRES_DB3__
%define REQUIRES_INIT_D __REQUIRES_INIT_D__
%define SMTPD_MULTILINE_GREETING __SMTPD_MULTILINE_GREETING__

%define branch release
%define vers 20010228
%define patchlevel pl03
%define version1 %{vers}-%{patchlevel}
%define version2 %{vers}_%{patchlevel}
%define rel  1
%define tlsno pfixtls-0.7.2-20010228-pl02-0.9.6a
%define pflogno -0.9.0

Name: postfix
Summary: Postfix Mail Transport Agent
Group: System Environment/Daemons
URL: http://www.postfix.org
Copyright: IBM Public License
PreReq: /sbin/chkconfig
# Required by RedHat 7.x
%if %{REQUIRES_INIT_D}
PreReq: /etc/init.d, /sbin/service
%endif
Provides: MTA smtpd smtpdaemon
Conflicts: sendmail, exim, qmail, smail
Version: %{version2}%{branch}
Release: %{rel}__SUFFIX__
Packager: Simon J Mudd <sjmudd@pobox.com>
Summary: Postfix Mail Server
Vendor: Built on __DISTRIBUTION__
Source0: ftp://ftp.porcupine.org/mirrors/postfix-release/official/%{name}-%{version1}.tar.gz
Source1: postfix-README_rpm.txt
Source2: postfix-README_maildrop_security.txt
Source3: postfix-etc-init.d-postfix
Source4: postfix-etc-cron.daily-postfix
Source5: postfix-aliases
Source6: postfix-chroot-setup.awk
Source7: postfix.spec.in
Source8: make-postfix.spec
Source9: ftp://ftp.aet.tu-cottbus.de/pub/postfix_tls/%{tlsno}.tar.gz
Source10: http://jimsun.linxnet.com/downloads/pflogsumm%{pflogno}.pl
Source11: postfix-build
Patch1:  postfix-config.patch
Patch2:  postfix-chroot_chk.patch
# required to install smtp-sink and smtp-source
Patch3:  postfix-INSTALL.sh.patch
# fix the smtpd_check.c, Wietse
Patch5: postfix-smtpd_check.c.patch
#
# Optional patches - set the appropriate environment variables to include
#                    them when building the package/spec file
#
# applied if %SMTPD_MULTILINE_GREETING=1
Patch99: postfix-smtpd_multiline_greeting.patch

BuildRoot: %{_tmppath}/%{name}-%{version1}-root

# Determine the different packages required for building postfix
BuildRequires: gawk, perl, sed

# Used on Red Hat 7.x
%if %{REQUIRES_DB3}
Requires: db3
BuildRequires: db3, db3-devel
%endif

%if %{LDAP}
Requires: openldap >= 1.2.9
BuildRequires: openldap >= 1.2.9, openldap-devel >= 1.2.9
%endif

%if %{PCRE}
Requires: pcre
BuildRequires: pcre, pcre-devel
%endif

%if %{REDHATMYSQL}
Requires: mysql, mysqlclient9
BuildRequires: mysql, mysqlclient9, mysql-devel
%endif
%if %{MYSQL}
Requires: MySQL-shared, zlib
BuildRequires: MySQL-shared, MySQL-devel, zlib-devel
%endif

%if %{SASL}
Requires: cyrus-sasl
BuildRequires: cyrus-sasl
%endif

%if %{TLS}
Requires: openssl
BuildRequires: openssl-devel
%endif

%description
Postfix is a Mail Transport Agent (MTA), intended to be an alternative
to the widely-used sendmail.  This is a reasonably sophisticated package
which includes optional support for LDAP, pcre, mysql, SMTP AUTH (SASL) and
TLS; it sets up chroot for added security; and it starts and stops the
daemon on install/remove.

See http://www.redhat.com/support/docs/faqs/RH-postfix-FAQ/book1.html,
a slightly outdated FAQ, which covers steps which should be taken prior
to and after the installation of Postfix.

The binary and source rpms I produce are currently stored on
	http://www.pobox.com/~sjmudd/postfix

This package/specfile was built from postfix.spec.in $Revision: 2.73.2.43 $,
with the following options:

SMTPD_MULTILINE_GREETING=__SMTPD_MULTILINE_GREETING__
LDAP=%{LDAP}		SASL=%{SASL}
PCRE=%{PCRE}		TLS=%{TLS}
MYSQL=%{MYSQL}		REDHATMYSQL=%{REDHATMYSQL}
REQUIRES_DB3 %{REQUIRES_DB3}	REQUIRES_INIT_D %{REQUIRES_INIT_D}

The source package contains information about rebuilding with alternative
options.


%define config_directory /etc/postfix
%define daemon_directory /usr/libexec/postfix
%define command_directory /usr/sbin
%define queue_directory /var/spool/postfix
%define newaliases_path /usr/bin/newaliases

%define mailq_path /usr/bin/mailq
%define rmail_path /usr/bin/rmail
# Postfix requires a unique uid & gid for its exclusive use
# Redhat's 'mail' user & group isn't unique!
%define uid 89
%define gid 89

%define init_directory /etc/rc.d/init.d
%define sendmail_path /usr/sbin/sendmail
%define cron_directory /etc/cron.daily

%define whinge logger -p mail.info -t postfix/rpm
%define postfix_running %{daemon_directory}/master -t >/dev/null 2>&1; echo $?

%prep
umask 022

# stop build if something is wrong
die(){ %whinge "$*"; exit 1; }

# Warn if the distribution this spec file was made for isn't the same as
# the current distribution
# possible distributions are variants of:
#	'redhat-release-7.0-1' or 'mandrake-release-7.1-1mdk'
# It would be nice to convert these to:
#	'redhat-release-7.0' and 'mandrake-release-7.1'
# or even
#	'redhat-release-7' and 'mandrake-release-7'
# and make the comparison at these levels.

CURRDIST=`rpm -qa | grep -- -release | egrep '(redhat-|mandrake-)'`
SPECDIST="__DISTRIBUTION__"

if [ "${CURRDIST}" != "${SPECDIST}" ]; then
    cat <<ENDTEXT

			W A R N I N G
			=============

This package's spec file was built for a different distribution to the
version which you are using.  If the differences (shown below) are only
a difference in MINOR version number this should not be a problem.

Current Distribution:	${CURRDIST}
postfix.spec built for:	${SPECDIST}

If not it is advisable to rebuild the postfix.spec file as indicated below:

To rebuild the spec file (and thus avoid this warning) follow the following
steps:

	cd ../SOURCES
	sh make-postfix.spec	# to rebuild the spec file
	cd ../SPECS
	rpm -ba postfix.spec	# to build postfix

If this procedure doesn't allow you to produce a working package, please
adivse me so I can take appropriate steps.

ENDTEXT
	sleep 5
else
	echo "postfix.spec seems ok"
fi

# warn before we start if we aren't root
if [ `id -u` != "0" ]; then
    cat <<-ENDTEXT
	ERROR: Your are not building postfix package as the superuser.
	ERROR: You MUST be the superuser to build the postfix package
	ERROR: as part of the package build process requires superuser privileges
	
	Please su - root and try again"
ENDTEXT
    exit 1
fi

%setup -q -n %{name}-%{version1} -a 9

# Apply the TLS patch, must be at first, because the changes of master.cf
%if %{TLS}
patch -p1 <%{tlsno}/pfixtls.diff
%endif

# APPLY OBLIGATORY PATCHES
%patch1 -p1 -b .config
%patch2 -p1 -b .chk
%patch3 -p1 -b .install
%patch5 -p1 -b .smtpd

# APPLY OPTIONAL PATCHES

# Apply my SMTPD Multiline greeting patch
%if %{SMTPD_MULTILINE_GREETING}
%patch99 -p1 -b .multiline
%endif

# Move around the TLS docs
%if %{TLS}
mkdir html/TLS
mv %{tlsno}/doc/* html/TLS
for i in ACKNOWLEDGEMENTS CHANGES INSTALL README TODO; do
  mv %{tlsno}/$i $i.TLS
done
%endif

# setup master.cf to be chrooted
mv conf/master.cf conf/master.cf-nochroot
awk -f ${RPM_SOURCE_DIR}/postfix-chroot-setup.awk < conf/master.cf-nochroot > conf/master.cf

# Copy README files allowing us to just go %doc below, and have rpm(1)
# automatically tuck it in alongside the READMEs and COPYRIGHTs.
cp ${RPM_SOURCE_DIR}/postfix-README_rpm.txt README_rpm.txt
cp ${RPM_SOURCE_DIR}/postfix-README_maildrop_security.txt \
	README_maildrop_security.txt

# create postfix user and group on BUILD machine if necessary

# Add the postfix group if not found
grep -q ^postfix: /etc/group || {
    groupadd -g %{gid} -r postfix || die \
            'gid collision, aborting install' \
	    'either add "postfix" group or delete the group using GID %{gid}'
    %whinge "Adding postfix to /etc/group."
}

# Add the postfix user if not found
grep -q ^postfix: /etc/passwd || {
    grep -q "^.*:.*:%{uid}:" /etc/passwd && die \
          'uid collision, aborting install' \
          'either add "postfix" user or delete the user using UID %{uid}'
    %whinge "Adding postfix to /etc/passwd."
    useradd -d %{queue_directory} -s /bin/true -g postfix -M -r -u %{uid} postfix
}

%build
umask 022

CCARGS=
AUXLIBS=

%if %{LDAP}
  CCARGS="${CCARGS} -DHAS_LDAP"
  AUXLIBS="${AUXLIBS} -L/usr/lib -lldap -llber"  
%endif
%if %{PCRE}
  CCARGS="${CCARGS} -DHAS_PCRE"
  AUXLIBS="${AUXLIBS} -lpcre"
%endif
# Careful:
# - mysql (redhat) doesn't seem to need zlib support (postfix compiles
#   without it)
# - MySQL (www.mysql.com) does need zlib support to compile correctly
%if %{MYSQL}
  CCARGS="${CCARGS} -DHAS_MYSQL -I/usr/include/mysql"
  AUXLIBS="${AUXLIBS} -L/usr/lib/mysql -lmysqlclient -lz -lm"
%endif
%if %{REDHATMYSQL}
  CCARGS="${CCARGS} -DHAS_MYSQL -I/usr/include/mysql"
  AUXLIBS="${AUXLIBS} -L/usr/lib/mysql -lmysqlclient -lm"
%endif
%if %{SASL}
  CCARGS="${CCARGS} -DUSE_SASL_AUTH"
  AUXLIBS="${AUXLIBS} -lsasl"
%endif
%if %{TLS}
  CCARGS="${CCARGS} -DHAS_SSL -I/usr/include/openssl"
  AUXLIBS="${AUXLIBS} -lssl -lcrypto"
%endif

export CCARGS AUXLIBS
make -f Makefile.init makefiles

unset CCARGS AUXLIBS
make DEBUG="" OPT="$RPM_OPT_FLAGS"

%pre
umask 022

# stop install if something is wrong
die(){ %whinge "$*"; exit 1; }

# create postfix user and group on INSTALL machine if necessary

# Add the postfix group if not found
grep -q ^postfix: /etc/group || {
    groupadd -g %{gid} -r postfix || die \
            'gid collision, aborting install' \
	    'either add "postfix" group or delete the group using GID %{gid}'
    %whinge "Adding postfix to /etc/group."
}

# Add the postfix user if not found
grep -q ^postfix: /etc/passwd || {
    grep -q "^.*:.*:%{uid}:" /etc/passwd && die \
          'uid collision, aborting install' \
          'either add "postfix" user or delete the user using UID %{uid}'
    %whinge "Adding postfix to /etc/passwd."
    useradd -d %{queue_directory} -s /bin/true -g postfix -M -r -u %{uid} postfix
}


%install
umask 022

/bin/rm -rf ${RPM_BUILD_ROOT}
/bin/mkdir -p ${RPM_BUILD_ROOT}

strip -R .comment bin/* libexec/*

# now install postfix into buildroot

export install_root=${RPM_BUILD_ROOT} \
       config_directory=%{config_directory} \
       daemon_directory=%{daemon_directory} \
       command_directory=%{command_directory} \
       queue_directory=%{queue_directory} \
       sendmail_path=%{sendmail_path} \
       newaliases_path=%{newaliases_path} \
       mailq_path=%{mailq_path} \
       manpages=%{_mandir}
sh INSTALL.sh < /dev/null

# Change the default directory for alias_maps and alias_database
# to %{config_directory}
bin/postconf -c ${RPM_BUILD_ROOT}%{config_directory} -e \
	"alias_maps = hash:%{config_directory}/aliases" \
	"alias_database = hash:%{config_directory}/aliases" \
|| exit 1 

# This installs into the /etc/rc.d/init.d directory
/bin/mkdir -p ${RPM_BUILD_ROOT}%{init_directory}
install -c ${RPM_SOURCE_DIR}/postfix-etc-init.d-postfix \
                  ${RPM_BUILD_ROOT}%{init_directory}/postfix

# Copy the Linux chroot setup script to %{config_directory} so
# we can use it to build the chroot environment during the install
#
# NOTE: we remove the 'postfix reload' call from this script
sed '
s;postfix reload;#postfix reload # - do not reenable - used by rpm;
' examples/chroot-setup/LINUX2 \
    > ${RPM_BUILD_ROOT}%{config_directory}/chroot-setup-LINUX2

chmod 0744 ${RPM_BUILD_ROOT}%{config_directory}/chroot-setup-LINUX2

# This is the /etc/cron.daily directory
/bin/mkdir -p ${RPM_BUILD_ROOT}%{cron_directory}

# This file is named 1postfix to ensure it is run _before_ logrotate
install -c ${RPM_SOURCE_DIR}/postfix-etc-cron.daily-postfix ${RPM_BUILD_ROOT}%{cron_directory}/1postfix

# install pflogsumm.pl used by cron daily into %{command_directory}
#
install -c -m u=rx,go= ${RPM_SOURCE_DIR}/pflogsumm%{pflogno}.pl ${RPM_BUILD_ROOT}%{command_directory}/pflogsumm.pl

install -c auxiliary/rmail/rmail ${RPM_BUILD_ROOT}%{rmail_path}

#
# copy new aliases files and generate a ghost aliases.db file
#
cp -f  ${RPM_SOURCE_DIR}/postfix-aliases ${RPM_BUILD_ROOT}%{config_directory}/aliases
chmod 644 ${RPM_BUILD_ROOT}%{config_directory}/aliases

touch ${RPM_BUILD_ROOT}/%{config_directory}/aliases.db


##############################################################################
# The post script executes after the package has been installed.  Here
# we put things that invoke files we just installed, and populate the
# directories we've created with local-dependent files.
%post
umask 022

ldap_chroot_setup() {
    for i in usr/lib/libldap.so.1 usr/lib/liblber.so.1; do
        if [ -e /$i ]; then
            cmp -s /$i %{queue_directory}/$i 2>/dev/null || \
                install -c /$i %{queue_directory}/$i
        fi
    done
}

/sbin/chkconfig --add postfix

# setup missing directory structures, but hide the warning message
%{command_directory}/postfix check 2>/dev/null

# this is the correct place to build the aliases.db file
%{command_directory}/postalias %{config_directory}/aliases

# setup chroot structure - basic structure
# - do not fail if the script fails
%{config_directory}/chroot-setup-LINUX2 || true

# setup chroot structure - when using LDAP
# Note: not entirely sure this is ok: missing .so and .so.1.0.0
%if %{LDAP}
    ldap_chroot_setup
%endif

%preun
umask 022

stop_postfix () {
    echo "Stopping the Postfix mail system"
    if [ -f %{queue_directory}/pid/master.pid ]; then
        kill `sed 1q %{queue_directory}/pid/master.pid` >/dev/null 2>&1 || true
    else
        echo "BUG: postfix.spec (preun) - please inform packager"
    fi
}

ldap_chroot_remove () {
    for i in usr/lib/libldap.so.1 usr/lib/liblber.so.1; do
        test -f %{queue_directory}/$i && \
            /bin/rm -f %{queue_directory}/$i
    done
}

# remove chroot jail when uninstalling the package
# WE MUST BE IN /var/spool/postfix before calling this routine

chroot_remove () {
    for i in etc/localtime usr/lib/zoneinfo/localtime \
            etc/host.conf etc/resolv.conf etc/nsswitch.conf \
	    etc/hosts etc/passwd etc/services \
	    lib/libnss_* lib/libresolv* lib/libdb*; do
        test -f $i && /bin/rm -f $i
    done

    for dir in usr/lib/zoneinfo usr/lib usr lib etc; do
        test -d $dir && /bin/rmdir $dir || \
	    echo "WARNING: preun - unable to remove directory %{queue_directory}/$dir"
    done
}

# selectively remove the rest of the queue directory structure
# first remove the "queues" (and assume the hash depth is still 2)
queue_directory_remove () {
    for dir in incoming active bounce defer flush; do
        for a in 0 1 2 3 4 5 6 7 8 9 A B C D E F; do
   	    test -d $dir/$a && {
	        for b in 0 1 2 3 4 5 6 7 8 9 A B C D E F; do
		    test -d $dir/$a/$b && (
		        /bin/rm -f $dir/$a/$b/*
		        /bin/rmdir $dir/$a/$b
		    )
		done
		/bin/rmdir $dir/$a || echo "WARNING: preun - unable to remove directory %{queue_directory}/$dir/$a"
	    }
        done
	/bin/rmdir $dir || echo "WARNING: preun - unable to remove directory %{queue_directory}/$dir"
    done

    # now remove the other directories
    for dir in corrupt deferred pid private public saved; do
        test -d $dir && {
            /bin/rm -f $dir/*
            /bin/rmdir $dir || echo "WARNING: preun - unable to remove directory %{queue_directory}/$dir"
        }
    done
}

if [ "$1" = 0 ]; then
    # stop postfix silently, but only if it's running
    if [ `%{postfix_running}` -eq 1 ]; then
#       echo "preun - RUNNING"
        stop_postfix
    else
#       echo "preun - NOT RUNNING"
        true
    fi

    /sbin/chkconfig --del postfix                    

    # userdel also deletes the user's group
    userdel postfix || : %whinge "WARNING: failed to remove user postfix"

    # safety check
    test "%{queue_directory}" = "" && echo "WARNING: chroot removal buggy - check .spec file" && exit 0

    # cd to %{queue_directory} before removing unwanted files
    cd %{queue_directory} && {
%if %{LDAP}
        ldap_chroot_remove
%endif
        chroot_remove
        queue_directory_remove
    }
    true # to ensure we exit safely
fi

%postun
umask 022

restart_postfix () {
    echo "Stopping   the Postfix mail system"
    if [ -f %{queue_directory}/pid/master.pid ]; then
        kill `sed 1q %{queue_directory}/pid/master.pid` >/dev/null 2>&1 || true
    else
        echo "BUG: postfix.spec (postun) - please inform packager"
    fi
    sleep 2 # to give things time to stop
    %{daemon_directory}/master &
    echo "Restarting the Postfix mail system"
}

if [ "$1" != 0 ]; then
    # restart postfix, but only if it was running
    if [ `%{postfix_running}` -eq 1 ]; then
#       echo "postun - RUNNING"
        restart_postfix
    else
#       echo "postun - NOT RUNNING"
        true
    fi
fi

%clean
/bin/rm -rf ${RPM_BUILD_ROOT}


%files
%defattr(-, root, root)
%verify(not md5 size mtime) %config %dir %{config_directory}
%attr(0755, root, root) %config %{config_directory}/postfix-script
%attr(0644, root, root) %verify(not md5 size mtime) %config(noreplace) %{config_directory}/main.cf
%attr(0644, root, root) %verify(not md5 size mtime) %config(noreplace) %{config_directory}/master.cf
%attr(0644, root, root) %verify(not md5 size mtime) %config %{config_directory}/install.cf
%attr(0644, root, root) %verify(not md5 size mtime) %config(noreplace) %{config_directory}/aliases
%attr(0644, root, root) %verify(not md5 size mtime) %ghost             %{config_directory}/aliases.db

%attr(0755, root, root) %config %{init_directory}/postfix
%attr(-, postfix, root) %verify(not md5 size mtime) %{queue_directory}
%attr(0755, root, root) %verify(not md5 size mtime) %config(noreplace) %{cron_directory}/1postfix

%doc 0README
%doc COMPATIBILITY
%doc DB_README
%doc DEBUG_README
%doc ETRN_README
%doc FILTER_README
%doc HISTORY
%doc INSTALL
%doc INSTALL.sh
%doc LDAP_README
%doc LICENSE
%doc LINUX_README
%doc LMTP_README
%doc MACOSX_README
%doc MYSQL_README
%doc PCRE_README
%doc PORTING
%doc RELEASE_NOTES
%doc RESTRICTION_CLASS
%doc SASL_README 
%doc TODO
%doc ULTRIX_README
%doc UUCP_README

%doc README_rpm.txt README_maildrop_security.txt

%if %{TLS}
%doc ACKNOWLEDGEMENTS.TLS
%doc CHANGES.TLS
%doc README.TLS
%doc TODO.TLS
%doc html/TLS/*
%endif

%doc conf
%doc html

%attr(0744, root, root) %config %{config_directory}/chroot-setup-LINUX2

%{daemon_directory}/bounce
%{daemon_directory}/cleanup
%{daemon_directory}/error
%{daemon_directory}/flush
%{daemon_directory}/lmtp
%{daemon_directory}/local
%{daemon_directory}/master
%{daemon_directory}/pickup
%{daemon_directory}/pipe
%{daemon_directory}/qmgr
%{daemon_directory}/showq
%{daemon_directory}/smtp
%{daemon_directory}/smtpd
%{daemon_directory}/spawn
%{daemon_directory}/trivial-rewrite

%if %{TLS}
%{daemon_directory}/tlsmgr
%endif

%{command_directory}/postalias
%{command_directory}/postcat
%{command_directory}/postconf
%{command_directory}/postdrop
%{command_directory}/postfix
%{command_directory}/postkick
%{command_directory}/postlock
%{command_directory}/postlog
%{command_directory}/postmap
%{command_directory}/postsuper

%{command_directory}/smtp-sink
%{command_directory}/smtp-source

%{command_directory}/pflogsumm.pl

%{sendmail_path}
%{mailq_path}
%{newaliases_path}
%attr(0755, root, root) %{rmail_path}

%{_mandir}/*/*

##############################################################################
# List of changes made to this package.
#
# Old changelog from Tue Dec 15 1998 - Dec 31 1999 has been removed.
#

%changelog

* Mon May 27 2001 Simon Mudd <sjmudd@pobox.com>
- postfix-20010228_pl03release-1
  - update to pl03

* Mon May 15 2001 Simon Mudd <sjmudd@pobox.com>
- postfix-20010228_pl02release-6
  - update pflogsumm.pl to 0.9.0
  - add more documentation to make-postfix.spec

* Mon May 15 2001 Simon Mudd <sjmudd@pobox.com>
- postfix-20010228_pl02release-5
  - change make-postfix.spec
  - update support for MySQL packages
  - add Summary: line
  - generate a warning if building on a different distribution than the
    one the postfix.spec file was made for.

* Mon May 07 2001 Simon Mudd <sjmudd@pobox.com>
- postfix-20010228_pl02release-4, add smtpd_check.c.patch
  provided by Wietse

* Wed May 02 2001 Simon Mudd <sjmudd@pobox.com>
- postfix-20010228_pl02release-3, update support for TLS patch
  - see http://www.aet.tu-cottbus.de-personen-jaenicke/postfix_tls/
  - report from: Peter Tuschy <peter@tuschy.com>

* Wed May 02 2001 Simon Mudd <sjmudd@pobox.com>
- postfix-20010228_pl02release-2, pflogsumm.pl was not included as a 
  Source file so building from source failed.  Fixed.
  Thanks to Emmanuel Seyman <seyman@moe.acticiel.com> for pointing this
  out.

* Tue May 01 2001 Simon Mudd <sjmudd@pobox.com>
- postfix-20010228_pl02release-1, update for postfix-20010228-pl02
  - rename %{cron_directory}/postfix to 1postfix to ensure that it is 
  run before logrotate. 
  - make small workaround for INSTALL.sh change which breaks install.

* Mon Apr 30 2001 Simon Mudd <sjmudd@pobox.com>
- postfix-20010228_pl01release-6, include support for pflogsumm.pl

* Sun Apr 29 2001 Simon Mudd <sjmudd@pobox.com>
- postfix-20010228_pl01release-5
  - following a suggestion by Daniel Roesen <droesen@entire-systems.com>
  mark /etc/cron.daily/postfix as a configuration file so that if people
  want to disable it they don't need to do so every time they upgrade the
  package.

* Mon Apr 24 2001 Simon Mudd <sjmudd@pobox.com>
- postfix-20010228_pl01release-4, minor update to keep in synch
  snapshot and release files.
- add egrep check, suggested in INSTALL to /etc/cron.d/postfix

* Tue Apr 17 2001 Simon Mudd <sjmudd@pobox.com>
- postfix-20010228_pl01release-3, update the TLS patch for pl01
  patch provided by Daniel Roesen <droesen@entire-systems.com>
  comments from Peter Tuschy <peter@tuschy.com>

* Mon Apr 02 2001 Peter Tuschy <peter@tuschy.com>
- postfix-20010228_pl01release-2
- bugfix specfile: TLS patch must be the first patch after setup line

* Fri Mar 30 2001 Simon Mudd <sjmudd@pobox.com>
- add support for TLS, patches provided by Peter Tuschy <peter@tuschy.com>
- postfix-20010228_pl01release-1, upgrade to postfix-20010228-pl01.tar.gz

* Fri Mar 23 2001 Simon Mudd <sjmudd@pobox.com>
- postfix-20010228release-3, remove the support in the startup script for
  multilanguage descriptions.  This doesn't work on some RH6 boxes.

* Wed Mar 07 2001 Simon Mudd <sjmudd@pobox.com>
- postfix-20010228release-2
- fix the awk dependency which was wrong

* Mon Mar 05 2001 Simon Mudd <sjmudd@pobox.com>
- build for postfix 20010228 release

* Wed Mar 01 2001 Simon Mudd <sjmudd@pobox.com>
- remove POSTFIX_SAFE_MYNETWORKS from make-postfix.spec
- snapshot-20010228-1,  update to latest snapshot
- include hashed incoming directory in chroot_remove

* Mon Feb 26 2001 Simon Mudd <sjmudd@pobox.com>
- snapshot-20010225-1,  update to latest snapshot
- remove references to POSTFIX_SAFE_MYNETWORKS optional patch as no longer
  required.

* Tue Feb 20 2001 Simon Mudd <sjmudd@pobox.com>
- snapshot-20010222-1,  update to latest snapshot
                        further minor changes to /etc/rc.d/init.d/postfix

* Tue Feb 20 2001 Simon Mudd <sjmudd@pobox.com>
- snapshot-20010204-4,  minor changes
  - fix spelling mistake in changelog, droesen's name
  - change -f check to -x in /etc/rc.d/init.d/postfix and
                             /etc/cron.daily/postfix
  - change /etc/rc.d/init.d/postfix to correctly show the [OK]
    and [FAILED] tags on startup.  I think this is correct, but the
    RedHat documentation is lacking here.

* Wed Feb 07 2001 Simon Mudd <sjmudd@pobox.com>
- snapshot-20010204-3, avoid the /var/spool/postfix/maildrop - directory
  not empty error message.

* Wed Feb 07 2001 Simon Mudd <sjmudd@pobox.com>
- snapshot-20010204-2, various changes - suggestions from Ben Cross
  - uninstall is not quite right.
  - spec file had a few rpmlint problems
  - one minor thing I can't find.  uninstalling gives a message
	/var/spool/postfix/maildrop - directory not empty - why????
	/etc/postfix not removed, but not too worried about this.

* Mon Feb 05 2001 Simon Mudd <sjmudd@pobox.com>
- snapshot-20010204-1, upgrade to latest snapshot
- fix problem when upgrading with postfix stopped
  (due to chroot-setup-LINUX2 having a call to postfix reload)

* Sun Feb 04 2001 Simon Mudd <sjmudd@pobox.com>
- snapshot-20010128-2, fix mysql build which had an error

* Mon Jan 30 2001 Simon Mudd <sjmudd@pobox.com>
- snapshot-20010128-1, update for latest snapshot

* Fri Jan 26 2001 Simon Mudd <sjmudd@pobox.com>
- snapshot-20001217-13, Mysql support was incorrect - fixed
  Ramiro Morales <rmrpms@usa.net>

* Fri Jan 26 2001 Simon Mudd <sjmudd@pobox.com>
- snapshot-20001217-12, include missing DB_README
- include support for both mysql (RedHat MySQL packages) and
  MySQL (www.mysql.com MySQL packages) as they use different
  names.  Introduction of new define REDHATMYSQL for the first
  case.  Suggestions by Ramiro Morales <rmrpms@usa.net>
- fix make-postfix.spec (missing -z checks) <ilmis@compart.fi>
- add Conflicts: for exim and qmail

* Sun Jan 21 2001 Simon Mudd <sjmudd@pobox.com>
- snapshot-20001217-11, following suggestion by Daniel Roesen
  remove newaliases when calling /etc/init.d/postfix start
- modify /etc/init.d/postfix to follow the newer rh7 style
- include fallback_relay patch (Wietse)
- update Daniel Roesen's broken auth patch

* Fri Jan 19 2001 Simon Mudd <sjmudd@pobox.com>
- snapshot-20001217-10, include LDAP chroot jail support

* Fri Jan 12 2001 Simon Mudd <sjmudd@pobox.com>
- snapshot-20001217-9, change description making it briefer and including
  URL to Bennett Todd's packages.
- Reduce dependency on postfix.spec.in, by using %if declarations

* Thu Jan 04 2001 Simon Mudd <sjmudd@pobox.com>
- snapshot-20001217-8, minor touches to build procedure

* Mon Dec 31 2000 Simon Mudd <sjmudd@pobox.com>
- snapshot-20001217-6, suggestions from Daniel Roesen <droesen@entire-systems.com>
- remove default LDAP support: RedHat only supports this by default on RH 6.2
  and later
- remove package build after building spec file (I was being lazy)
- fix a couple of typos
- warn if user is trying to build the package when he is not the superuser

* Fri Dec 22 2000 Simon Mudd <sjmudd@pobox.com>
- snapshot-20001217-5
- include Requires: /etc/init.d if built on rh7
- change POSTFIX_SMTPD_MULTILINE to POSTFIX_SMTPD_MULTILINE_GREETING

* Fri Dec 22 2000 Simon Mudd <sjmudd@pobox.com>
- snapshot-20001217-3, support for rh7 building
  - if built on a rh7 machine, the spec file will include a Requires:
    for db3/db3-devel.
  - include the Requires: and BuildRequires: support for use with
    openldap, mysql, pcre, and cyrus-sasl packages
  ( current build also shows the version of redhat the spec file
    was generated on, just to make things a bit clearer )

* Fri Dec 22 2000 Simon Mudd <sjmudd@pobox.com>
- snapshot-20001217-2, major changes so that I
  can build any spec file to include mysql, ldap, pcre
  and AUTH support.  This is not finished but basically
  just requires the Requires: lines to work properly.
- add Broken auth support Daniel Roesen <droesen@entire-systems.com>

* Mon Dec 18 2000 Simon Mudd <sjmudd@pobox.com>
- snapshot-20001217-1, no changes, updating to latest snapshot

* Thu Dec 13 2000 Simon Mudd <sjmudd@pobox.com>
- snapshot-20001212-3, minor fixes
  %{queue_directory} removal while correct as probably a bit dangerous
  so try and be a bit safer.
  stop gzipping the man pages (I think this is done automatically now)

* Thu Dec 13 2000 Simon Mudd <sjmudd@pobox.com>
- snapshot-20001212-2, minor fixes
  %{queue_directory} removal wasn't correct

* Wed Dec 13 2000 Simon Mudd <sjmudd@pobox.com>
- snapshot-20001212-1, several changes following comments from
  Daniel Roesen <droesen@entire-systems.com>
  Tuomo Soini <tis@foobar.fi>
  - change chroot removal on package uninstallation
  - rebuild aliases.db on package installation not build
  - tidy up stop/start over package upgrade
  - change method for selectively installing patches
      now use POSTFIX_SMTPD_MULTILINE=1 for smtpd multiline greetings
              POSTFIX_SAFE_MYNETWORKS=1 for droesen's patch
  - create postfix user/group on package build if necessary
  - include smtp-source/smtp-sink for testing
  - include comments in spec file for building with other libraries
      this is so later I can do this automatically

* Thu Nov 23 2000 Simon Mudd <sjmudd@pobox.com>
- snapshot-20001121-4, several minor fixes following comments from
  Daniel Roesen <droesen@entire-systems.com>
  1. fix /etc/cron.daily/postfix
  2. remove /etc/postfix/aliases.db %ghost attribute
     (trying to remove error messages related to file not existing, I think
      that this is due to it not being copied over)
  3. trying to cure the uninstall complaining about files left over in 
     /var/spool/postfix
  4. remove groupdel which is not required after userdel on uninstall

* Thu Nov 23 2000 Simon Mudd <sjmudd@pobox.com>
- snapshot-20001121-3,
  fix minor error in chroot jail removal

* Thu Nov 23 2000 Simon Mudd <sjmudd@pobox.com>
- snapshot-20001121-2,
  didn't like chroot jail setup in -1, so now I use the example script
  to build the jail on package installation

- snapshot-20001121-1, makedefs should be fixed (but can't check)
  chroot jail now built on postfix start (from /etc/rc.d/init.d/postfix)
  change invocation of INSTALL.sh when installing into ${BUILD_ROOT}

* Tue Nov 07 2000 Simon Mudd <sjmudd@pobox.com>
- snapshot-20001030-2, add chkconfig postfix to /etc/cron.daily/postfix
  fix Wietse's makedefs so this builds on rh6.x and rh7.
  checked with Patrick Reich <dminor@adelade.org>

* Wed Nov 01 2000 Simon Mudd <sjmudd@pobox.com>
- snapshot-20001030-1, need to refix patch for RedHat 7 which 
  I don't yet have installed on my machine.

* Fri Oct 27 2000 Simon Mudd <sjmudd@pobox.com>
- snapshot-20001005-6, include patch so will build on RedHat 7,
  provided by Jim Drash <jdrash@one.net>
                    
* Sat Oct 14 2000 Simon Mudd <sjmudd@pobox.com>
- snapshot-20001005-5, include lmtp, nqmgr, spawn in %files section

* Thu Oct 12 2000 Simon Mudd <sjmudd@pobox.com>
- snapshot-20001005-4, fix chroot awk script which was wrong

* Thu Oct 12 2000 Simon Mudd <sjmudd@pobox.com>
- snapshot-20001005-3, changes url shown for my packages.

* Sun Oct 08 2000 Simon Mudd <sjmudd@pobox.com>
- built for snapshot-20001005-2, tidying up and taking in _some_
  of the stuff I've seen on one of redhat's postfix spec files.
  Also corrected the multiline patch.

* Sun Jun 04 2000 Simon Mudd <sjmudd@pobox.com>
- built for postfix-19991231-pl08

* Sun Apr 15 2000 Simon Mudd <sjmudd@pobox.com>
- built for postfix-19991231-pl07

* Fri Mar 30 2000 Simon Mudd <sjmudd@pobox.com>
- built for postfix-19991231-pl06

* Fri Mar 10 2000 Simon Mudd <sjmudd@pobox.com>
- built for postfix-19991231-pl05

* Tue Feb 01 2000 Simon Mudd <sjmudd@pobox.com>
- include the patch which optionally delays check_msg_size()

* Mon Jan 31 2000 Simon Mudd <sjmudd@pobox.com>
- built for postfix-19991231-pl04

* Fri Jan 28 2000 Simon Mudd <sjmudd@pobox.com>
- built for postfix-19991231-pl03
- add warning option (which is not enabled by default on standard postfix
  config)
- add comments of possible builders of binary s390 and alpha packages

* Thu Jan 13 2000 Tim Powers <timp@redhat.com>
- removing the whinge stuff from the pre and post sections to meet Red Hat
	policy
- quiet setup 
- built for Powertools 6.2

* Thu Jan 13 2000 Simon Mudd <sjmudd@pobox.com>
- fix the postalias command which needed the '-c' option
  specified.  (Edward S. Marshall <emarshal@logic.net>)

- fix the rpm-3.x problem with defines not being commented out
  and comment that part of the spec file so that I don't get
  caught again. (It works on my platform with rpm-2.x!)

* Tue Jan 04 2000 Simon Mudd <sjmudd@pobox.com>
- update to work with postfix-19991231-pl02

* Tue Jan 04 2000 Simon Mudd <sjmudd@pobox.com>
- update to work with postfix-19991231-pl01
- and the ghost parameter for aliases.db

* Tue Jan 04 2000 Simon Mudd <sjmudd@pobox.com>
- Fix BEWARE problem in doc
- change man page compression to work on required files

